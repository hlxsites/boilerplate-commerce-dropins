import{jsxs as M,jsx as c,Fragment as C}from"@dropins/tools/preact-jsx-runtime.js";import{classes as S}from"@dropins/tools/lib.js";import{Card as L,InLineAlert as R,Icon as k,Button as q,Field as D,Picker as w,Input as V,InputDate as g,Checkbox as F,TextArea as U}from"@dropins/tools/components.js";import{useRef as H,useState as N,useEffect as G,useCallback as A,useMemo as X}from"@dropins/tools/preact-hooks.js";import{Text as _,useText as v}from"@dropins/tools/i18n.js";import*as I from"@dropins/tools/preact-compat.js";import{memo as x,useCallback as O}from"@dropins/tools/preact-compat.js";import{events as P}from"@dropins/tools/event-bus.js";import{e as W}from"../chunks/getGuestOrder.js";import"@dropins/tools/fetch-graphql.js";const z=r=>I.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},I.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M11.8052 14.4968C10.8552 14.4968 9.9752 14.0268 9.4452 13.2368L9.4152 13.1868L9.3852 13.1268C8.1352 11.2268 7.5352 8.96681 7.6852 6.68681C7.7552 4.42681 9.6052 2.61681 11.8652 2.60681H12.0052C14.2752 2.47681 16.2152 4.21681 16.3452 6.47681C16.3452 6.55681 16.3452 6.62681 16.3452 6.70681C16.4852 8.94681 15.9052 11.1768 14.6852 13.0568L14.6052 13.1768C14.0552 13.9868 13.1352 14.4668 12.1652 14.4768H12.0052C11.9352 14.4768 11.8652 14.4868 11.7952 14.4868L11.8052 14.4968Z",stroke:"currentColor"}),I.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M4.3252 21.5469C4.3552 20.4169 4.4752 19.2869 4.6752 18.1769C4.8952 17.1669 6.4752 16.0269 8.9052 15.1569C9.2352 15.0369 9.4852 14.7869 9.5952 14.4569L9.8052 14.0269",stroke:"currentColor"}),I.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M14.425 14.4069L14.165 14.1569C14.375 14.5969 14.725 14.9569 15.155 15.1869C16.945 15.7969 19.125 16.9569 19.375 18.2069C19.585 19.3069 19.685 20.4269 19.675 21.5369",stroke:"currentColor"})),Z=r=>I.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...r},I.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),j=({onSubmit:r,loading:t,inLineAlert:i,fieldsConfig:n})=>M(L,{variant:"secondary",className:"dropin-order-search-form",children:[c("h2",{className:"dropin-order-search-form__title",children:c(_,{id:"Order.OrderSearchForm.title"})}),c("p",{children:c(_,{id:"Order.OrderSearchForm.description"})}),i.text?c(R,{"data-testid":"orderAlert",className:"dropin-order-search-form__alert",type:i.type,variant:"secondary",heading:i.text,icon:c(k,{source:Z})}):null,c(K,{className:"dropin-order-search-form__wrapper",name:"orderSearchForm",loading:t,fieldsConfig:n,onSubmit:r,children:c("div",{className:"dropin-order-search-form__button-container",children:c(q,{className:"dropin-order-search-form__button",size:"medium",variant:"primary",type:"submit",disabled:t,children:c(_,{id:"Order.OrderSearchForm.button"})},"logIn")})})]}),Y=r=>r.reduce((t,{code:i,required:n,defaultValue:d})=>(n&&(t[i]=d),t),{}),J=({fieldsConfig:r,onSubmit:t})=>{const{requiredFieldError:i}=v({requiredFieldError:"Order.Form.notifications.requiredFieldError"}),n=H(null),[d,s]=N({}),[f,l]=N({});G(()=>{if(!r||!r.length)return;const h=Y(r);s(h)},[r==null?void 0:r.length]);const p=A((h,e)=>{const a=r.find(u=>u.code===h);return a!=null&&a.required&&!e?i:""},[r,i]),T=A(h=>{const{name:e,value:a,type:o,checked:u}=h==null?void 0:h.target,b=o==="checkbox"?u:a;s(m=>({...m,[e]:b}))},[]),$=A(h=>{const{name:e,value:a,type:o,checked:u}=h==null?void 0:h.target,b=o==="checkbox"?u:a;l(m=>({...m,[e]:p(e,b)}))},[p]),E=A(h=>{h.preventDefault();let e=!0,a={},o=null;for(const[u,b]of Object.entries(d)){const m=p(u,b);m&&(a[u]=m,e=!1,o||(o=u))}if(l(a),o&&n.current){const u=n.current.elements.namedItem(o);u==null||u.focus()}t==null||t(h,e)},[d,p,t]);return{formData:d,errors:f,formRef:n,handleChange:T,handleBlur:$,handleSubmit:E}},B=x(({loading:r,values:t,fields:i=[],errors:n,className:d="",onChange:s,onBlur:f})=>{const l=`${d}__item`,p=O((e,a,o)=>{const u=e.options.map(b=>({text:b.label,value:b.value}));return c(D,{error:o,className:S([l,`${l}--${e.id}`,[`${l}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${d}--${e.id}`,disabled:r,children:c(w,{name:e.id,floatingLabel:`${e.label} ${e.required?"*":""}`,placeholder:e.label,"aria-label":e.label,options:u,onBlur:f,handleSelect:s,value:a||e.defaultValue})},e.id)},[d,r,l,f,s]),T=O((e,a,o)=>{const u=e.id==="email",b=u?c(z,{}):void 0,m=u?"username":"";return c(D,{error:o,className:S([l,`${l}--${e.id}`,[`${l}--${e.id}-hidden`,e==null?void 0:e.is_hidden],e.className]),"data-testid":`${d}--${e.id}`,disabled:r,children:c(V,{"aria-label":e.label,"aria-required":e.required,autoComplete:m,icon:b,type:"text",name:e.id,value:a||e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:f,onChange:s})},e.id)},[d,r,l,f,s]),$=O((e,a,o)=>c(D,{error:o,className:S([l,`${l}--${e.id}`,[`${l}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${d}--${e.id}`,disabled:r,children:c(g,{type:"text",name:e.id,value:a||e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:f,onChange:s})},e.id),[d,r,l,f,s]),E=O((e,a,o)=>c(D,{error:o,className:S([l,`${l}--${e.id}`,[`${l}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${d}--${e.id}`,disabled:r,children:c(F,{name:e.id,checked:a||e.defaultValue,placeholder:e.label,label:`${e.label} ${e.required?"*":""}`,onBlur:f,onChange:s})},e.id),[d,r,l,f,s]),h=O((e,a,o)=>c(D,{error:o,className:S([l,`${l}--${e.id}`,[`${l}--${e.id}-hidden`,e.is_hidden],e.className]),"data-testid":`${d}--${e.id}`,disabled:r,children:c(U,{type:"text",name:e.id,value:a===void 0?e.defaultValue:a,label:`${e.label} ${e.required?"*":""}`,onBlur:f,onChange:s})},e.id),[d,r,l,f,s]);return i.length?c(C,{children:i.map(e=>{var u;const a=(n==null?void 0:n[e.id])??"",o=(t==null?void 0:t[e.id])??"";switch(e.fieldType){case"TEXT":return(u=e==null?void 0:e.options)!=null&&u.length?p(e,o,a):T(e,o,a);case"MULTILINE":return T(e,o,a);case"SELECT":return p(e,o,a);case"DATE":return $(e,o,a);case"BOOLEAN":return E(e,o,a);case"TEXTAREA":return h(e,o,a);default:return null}})}):null}),K=x(({name:r,loading:t,children:i,className:n="defaultForm",fieldsConfig:d,onSubmit:s})=>{const{formData:f,errors:l,formRef:p,handleChange:T,handleBlur:$,handleSubmit:E}=J({fieldsConfig:d,onSubmit:s});return M("form",{className:S(["dropin-form",n]),onSubmit:E,name:r,ref:p,children:[c(B,{className:n,loading:t,fields:d,onChange:T,onBlur:$,errors:l,values:f}),i]})});var y=(r=>(r.BOOLEAN="BOOLEAN",r.DATE="DATE",r.DATETIME="DATETIME",r.DROPDOWN="DROPDOWN",r.FILE="FILE",r.GALLERY="GALLERY",r.HIDDEN="HIDDEN",r.IMAGE="IMAGE",r.MEDIA_IMAGE="MEDIA_IMAGE",r.MULTILINE="MULTILINE",r.MULTISELECT="MULTISELECT",r.PRICE="PRICE",r.SELECT="SELECT",r.TEXT="TEXT",r.TEXTAREA="TEXTAREA",r.UNDEFINED="UNDEFINED",r.VISUAL="VISUAL",r.WEIGHT="WEIGHT",r.EMPTY="",r))(y||{});const Q=r=>{if(!r)return null;const t=new FormData(r);if(r.querySelectorAll('input[type="checkbox"]').forEach(n=>{t.has(n.name)||t.set(n.name,"false"),n.checked&&t.set(n.name,"true")}),t&&typeof t.entries=="function"){const n=t.entries();if(n&&typeof n[Symbol.iterator]=="function")return JSON.parse(JSON.stringify(Object.fromEntries(n)))||{}}return{}},ee=({onError:r})=>{const[t,i]=N({text:"",type:"success"}),[n,d]=N(!1),s=v({invalidSearch:"Order.Errors.invalidSearch",email:"Order.OrderSearchForm.email",postcode:"Order.OrderSearchForm.postcode",number:"Order.OrderSearchForm.orderNumber"}),f=X(()=>[{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:s.email,options:[],defaultValue:"",fieldType:y.TEXT,className:"",required:!0,orderNumber:1,name:"email",id:"email",code:"email"},{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:s.postcode,options:[],defaultValue:"",fieldType:y.TEXT,className:"",required:!0,orderNumber:2,name:"postcode",id:"postcode",code:"postcode"},{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:s.number,options:[],defaultValue:"",fieldType:y.TEXT,className:"",required:!0,orderNumber:3,name:"number",id:"number",code:"number"}],[s]);return{onSubmit:A(async(p,T)=>{if(!T)return null;d(!0);const $=Q(p.target);await W($).then(E=>{E||i({text:s.invalidSearch,type:"warning"}),P.emit("order/data",E)}).catch(E=>{r==null||r({error:E.message,formValues:$}),i({text:E.message,type:"warning"})}).finally(()=>{d(!1)})},[r,s]),inLineAlert:t,loading:n,normalizeFieldsConfig:f}},ue=({className:r,onError:t})=>{const{onSubmit:i,loading:n,inLineAlert:d,normalizeFieldsConfig:s}=ee({onError:t});return c("div",{className:S(["dropin-order-search",r]),children:c(j,{onSubmit:i,loading:n,inLineAlert:d,fieldsConfig:s})})};export{ue as OrderSearch,ue as default};
