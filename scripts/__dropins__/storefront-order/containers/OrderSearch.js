import{jsxs as E,jsx as a}from"@dropins/tools/preact-jsx-runtime.js";import{classes as T}from"@dropins/tools/lib.js";import{Card as S,InLineAlert as I,Icon as O,Button as N}from"@dropins/tools/components.js";import{F as y}from"../chunks/OrderLoaders.js";import{useState as m,useMemo as A,useCallback as D}from"@dropins/tools/preact-hooks.js";import*as f from"@dropins/tools/preact-compat.js";import{Text as d,useText as b}from"@dropins/tools/i18n.js";import{events as g}from"@dropins/tools/event-bus.js";import{i as M}from"../chunks/getGuestOrder.js";import"@dropins/tools/fetch-graphql.js";const _=e=>f.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},f.createElement("path",{vectorEffect:"non-scaling-stroke",fillRule:"evenodd",clipRule:"evenodd",d:"M1 20.8953L12.1922 1.5L23.395 20.8953H1ZM13.0278 13.9638L13.25 10.0377V9H11.25V10.0377L11.4722 13.9638H13.0278ZM11.2994 16V17.7509H13.2253V16H11.2994Z",fill:"currentColor"})),v=({onSubmit:e,loading:t,inLineAlert:o,fieldsConfig:r})=>E(S,{variant:"secondary",className:"dropin-order-search-form",children:[a("h2",{className:"dropin-order-search-form__title",children:a(d,{id:"Order.OrderSearchForm.title"})}),a("p",{children:a(d,{id:"Order.OrderSearchForm.description"})}),o.text?a(I,{"data-testid":"orderAlert",className:"dropin-order-search-form__alert",type:o.type,variant:"secondary",heading:o.text,icon:a(O,{source:_})}):null,a(y,{className:"dropin-order-search-form__wrapper",name:"orderSearchForm",loading:t,fieldsConfig:r,onSubmit:e,children:a("div",{className:"dropin-order-search-form__button-container",children:a(N,{className:"dropin-order-search-form__button",size:"medium",variant:"primary",type:"submit",disabled:t,children:a(d,{id:"Order.OrderSearchForm.button"})},"logIn")})})]});var c=(e=>(e.BOOLEAN="BOOLEAN",e.DATE="DATE",e.DATETIME="DATETIME",e.DROPDOWN="DROPDOWN",e.FILE="FILE",e.GALLERY="GALLERY",e.HIDDEN="HIDDEN",e.IMAGE="IMAGE",e.MEDIA_IMAGE="MEDIA_IMAGE",e.MULTILINE="MULTILINE",e.MULTISELECT="MULTISELECT",e.PRICE="PRICE",e.SELECT="SELECT",e.TEXT="TEXT",e.TEXTAREA="TEXTAREA",e.UNDEFINED="UNDEFINED",e.VISUAL="VISUAL",e.WEIGHT="WEIGHT",e.EMPTY="",e))(c||{});const R=e=>{if(!e)return null;const t=new FormData(e);if(e.querySelectorAll('input[type="checkbox"]').forEach(r=>{t.has(r.name)||t.set(r.name,"false"),r.checked&&t.set(r.name,"true")}),t&&typeof t.entries=="function"){const r=t.entries();if(r&&typeof r[Symbol.iterator]=="function")return JSON.parse(JSON.stringify(Object.fromEntries(r)))||{}}return{}},C=({onError:e})=>{const[t,o]=m({text:"",type:"success"}),[r,i]=m(!1),n=b({invalidSearch:"Order.Errors.invalidSearch",email:"Order.OrderSearchForm.email",postcode:"Order.OrderSearchForm.postcode",number:"Order.OrderSearchForm.orderNumber"}),p=A(()=>[{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:n.email,options:[],defaultValue:"",fieldType:c.TEXT,className:"",required:!0,orderNumber:1,name:"email",id:"email",code:"email"},{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:n.postcode,options:[],defaultValue:"",fieldType:c.TEXT,className:"",required:!0,orderNumber:2,name:"postcode",id:"postcode",code:"postcode"},{entity_type:"CUSTOMER_ADDRESS",is_unique:!1,label:n.number,options:[],defaultValue:"",fieldType:c.TEXT,className:"",required:!0,orderNumber:3,name:"number",id:"number",code:"number"}],[n]);return{onSubmit:D(async(u,h)=>{if(!h)return null;i(!0);const l=R(u.target);await M(l).then(s=>{s||o({text:n.invalidSearch,type:"warning"}),g.emit("order/data",s)}).catch(async s=>{(await(e==null?void 0:e({error:s.message,formValues:l}))??!0)&&o({text:s.message,type:"warning"})}).finally(()=>{i(!1)})},[e,n]),inLineAlert:t,loading:r,normalizeFieldsConfig:p}},B=({className:e,onError:t})=>{const{onSubmit:o,loading:r,inLineAlert:i,normalizeFieldsConfig:n}=C({onError:t});return a("div",{className:T(["dropin-order-search",e]),children:a(v,{onSubmit:o,loading:r,inLineAlert:i,fieldsConfig:n})})};export{B as OrderSearch,B as default};
