import{jsx as n,jsxs as c,Fragment as N}from"@dropins/tools/preact-jsx-runtime.js";import{Slot as T,classes as E}from"@dropins/tools/lib.js";import{Image as I,Card as _,Header as b,Accordion as P,AccordionSection as $}from"@dropins/tools/components.js";import"../chunks/OrderLoaders.js";import{S as A,C as j}from"../chunks/OrderLoaders2.js";import{useCallback as k,useMemo as L,useState as w,useEffect as B}from"@dropins/tools/preact-hooks.js";import{useText as F}from"@dropins/tools/i18n.js";import{events as H}from"@dropins/tools/event-bus.js";import"@dropins/tools/preact-compat.js";const M=({slots:e,orderData:i,shippingInfoMessage:p})=>{var m,g,S;const s=F({carrier:"Order.ShippingStatusCard.carrier",prepositionOf:"Order.ShippingStatusCard.prepositionOf"}),a=k(r=>r.map(t=>{var d,h,v,f,C,y;const o=(v=(h=(d=t==null?void 0:t.orderItem)==null?void 0:d.product)==null?void 0:h.thumbnail)==null?void 0:v.label,l=(y=(C=(f=t==null?void 0:t.orderItem)==null?void 0:f.product)==null?void 0:C.thumbnail)==null?void 0:y.url;return n(I,{alt:o,src:l,width:85,height:114},t.id)}),[]),O=k(r=>r.map(t=>c("span",{children:[t.title," | ",t.number,n("br",{})]},t.number)),[]),u=L(()=>{var r;return((r=i==null?void 0:i.shipments)==null?void 0:r.length)===1},[i]),x=L(()=>{var r;return u&&((r=i==null?void 0:i.status)==null?void 0:r.includes(A.COMPLETE))},[i,u]);return!i||(m=i==null?void 0:i.status)!=null&&m.includes(A.CANCELED)?null:(g=i==null?void 0:i.shipments)!=null&&g.length?n(N,{children:(S=i==null?void 0:i.shipments)==null?void 0:S.map((r,t,o)=>{const{tracking:l,items:d}=r,h=`${t+1} ${s.prepositionOf} ${o.length}`;return c(_,{variant:"secondary",className:"dropin-shipping-status-card",children:[n(b,{title:"Shipping",cta:u?n(N,{}):n("span",{className:"dropin-shipping-status-card--count-steper",children:h})}),c("div",{className:"dropin-shipping-status-card__header",children:[c("div",{className:"dropin-shipping-status-card__header--content",children:[l.length?c("p",{children:[s.carrier," ",O(l)]}):null,n("p",{children:p})]}),e!=null&&e.DeliveryTrackActions?n(T,{"data-testid":"deliverySlotActions",name:"DeliveryTrackActions",slot:e==null?void 0:e.DeliveryTrackActions,context:{}}):null]}),x?null:n(P,{actionIconPosition:"right","data-testid":"dropinAccordion",children:n($,{title:`Package contents (${d.length} items)`,children:n("div",{className:"dropin-shipping-status-card__images",children:a(d)})})}),e!=null&&e.DeliveryTimeLine?n(T,{"data-testid":"deliverySlotTimeLine",name:"DeliveryTimeLine",slot:e==null?void 0:e.DeliveryTimeLine,context:{}}):null]},r.id)})}):c(_,{variant:"secondary",className:"dropin-shipping-status-card",children:[n(b,{title:"Shipping info"}),n("div",{className:"dropin-shipping-status-card__header",children:c("div",{className:"dropin-shipping-status-card__header--content",children:[c("p",{children:[s.carrier," TBD"]}),n("p",{children:p})]})})]})},q=({orderData:e})=>{const[i,p]=w(e);return B(()=>{H.on("order/data",s=>{p(s)},{eager:!0})},[]),{order:i}},X=({slots:e,className:i,shippingInfoMessage:p,orderData:s})=>{const{order:a}=q({orderData:s});return n("div",{className:E(["dropin-shipping-status",i]),children:a?n(M,{slots:e,orderData:a,shippingInfoMessage:p}):n(j,{withCard:!1})})};export{X as ShippingStatus,X as default};
