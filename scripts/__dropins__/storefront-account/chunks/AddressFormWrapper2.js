import{jsx as a,Fragment as H,jsxs as R}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as W,useState as O,useEffect as V,useCallback as L}from"@dropins/tools/preact-hooks.js";import{useText as G}from"@dropins/tools/i18n.js";import{classes as y,Slot as g}from"@dropins/tools/lib.js";import{memo as U,useCallback as z}from"@dropins/tools/preact-compat.js";import{Field as M,Picker as P,Input as X,InputDate as C,Checkbox as w,TextArea as B,Skeleton as q,SkeletonRow as E,Card as j}from"@dropins/tools/components.js";const v=r=>r.reduce(($,{code:T,required:I,defaultValue:s})=>(I&&T&&(typeof s=="string"||typeof s=="number"||typeof s=="boolean")&&($[T]=s),$),{}),Y=({fieldsConfig:r,onSubmit:$,handleSetCountryCode:T,onChange:I})=>{const{requiredFieldError:s}=G({requiredFieldError:"Account.FormText.requiredFieldError"}),p=W(null),[i,t]=O({}),[S,A]=O({});V(()=>{if(!r||!r.length)return;const l=v(r);t(l)},[r==null?void 0:r.length]);const[f,D]=O({previousCountryCode:null,previousRegionCode:null,initialLoad:!0});V(()=>{var h;const l=i.country_code,d=r==null?void 0:r.find(u=>u.code==="region");if(f.initialLoad)D(u=>({...u,previousCountryCode:l,initialLoad:!1}));else if(f.previousCountryCode!==l){D(c=>({...c,previousCountryCode:l}));const u=!((h=d==null?void 0:d.options)!=null&&h.length)&&!(d!=null&&d.defaultValue)||f.previousRegionCode?"":(d==null?void 0:d.defaultValue)??"";t(c=>({...c,region:u})),T(l)}d!=null&&d.defaultValue&&f.previousCountryCode===l&&D(u=>({...u,previousRegionCode:d.defaultValue}))},[r,i,f.previousCountryCode,f.initialLoad,f.previousRegionCode,T,t]),V(()=>{if(!(r!=null&&r.length))return;const l=v(r);t(l)},[r==null?void 0:r.length]);const b=L((l,d)=>{const h=r.find(u=>u.code===l);return h!=null&&h.required&&!d?s:""},[r,s]),e=L(l=>{const{name:d,value:h,type:u,checked:c}=l==null?void 0:l.target,x=u==="checkbox"?c:h;t(k=>({...k,[d]:x}))},[]),n=L(l=>{const d=l.currentTarget,h=l.target,u=new FormData(d),c=Object.fromEntries(u.entries()),x={[h.name]:c[h.name]&&String(c[h.name])};I==null||I(c,x,l)},[I]),o=L(l=>{const{name:d,value:h,type:u,checked:c}=l==null?void 0:l.target,x=u==="checkbox"?c:h;A(k=>({...k,[d]:b(d,x)}))},[b]),F=L(l=>{l.preventDefault();let d=!0,h={},u=null;for(const[c,x]of Object.entries(i)){const k=b(c,x);k&&(h[c]=k,d=!1,u||(u=c))}if(A(h),u&&p.current){const c=p.current.elements.namedItem(u);c==null||c.focus()}$==null||$(l,d)},[i,b,$]);return{formData:i,errors:S,formRef:p,handleInputChange:e,handleFormChange:n,handleBlur:o,handleSubmit:F}};var N=(r=>(r.BOOLEAN="BOOLEAN",r.DATE="DATE",r.DATETIME="DATETIME",r.DROPDOWN="DROPDOWN",r.FILE="FILE",r.GALLERY="GALLERY",r.HIDDEN="HIDDEN",r.IMAGE="IMAGE",r.MEDIA_IMAGE="MEDIA_IMAGE",r.MULTILINE="MULTILINE",r.MULTISELECT="MULTISELECT",r.PRICE="PRICE",r.SELECT="SELECT",r.TEXT="TEXT",r.TEXTAREA="TEXTAREA",r.UNDEFINED="UNDEFINED",r.VISUAL="VISUAL",r.WEIGHT="WEIGHT",r.EMPTY="",r))(N||{});const m=U(({loading:r,values:$,fields:T=[],errors:I,className:s="",onChange:p,onBlur:i})=>{const t=`${s}__field`,S=z((e,n,o)=>a(M,{error:o,className:y([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(P,{name:e.id,floatingLabel:`${e.label} ${e.required?"*":""}`,placeholder:e.label,"aria-label":e.label,options:e.options,onBlur:i,handleSelect:p,value:n||e.defaultValue})},e.id),[s,r,t,i,p]),A=z((e,n,o)=>a(M,{error:o,className:y([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(X,{type:"text",name:e.id,value:n??e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:p})},e.id),[s,r,t,i,p]),f=z((e,n,o)=>a(M,{error:o,className:y([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(C,{type:"text",name:e.id,value:n||e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:p})},e.id),[s,r,t,i,p]),D=z((e,n,o)=>a(M,{error:o,className:y([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(w,{name:e.id,checked:n||e.defaultValue,placeholder:e.label,label:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:p})},e.id),[s,r,t,i,p]),b=z((e,n,o)=>a(M,{error:o,className:y([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(B,{type:"text",name:e.id,value:n??e.defaultValue,label:`${e.label} ${e.required?"*":""}`,onBlur:i,onChange:p})},e.id),[s,r,t,i,p]);return T.length?a(H,{children:T.map(e=>{const n=I==null?void 0:I[e.id],o=$==null?void 0:$[e.id];switch(e.fieldType){case N.TEXT:return e.options.length?S(e,o,n):A(e,o,n);case N.MULTILINE:return A(e,o,n);case N.SELECT:return S(e,o,n);case N.DATE:return f(e,o,n);case N.BOOLEAN:return D(e,o,n);case"TEXTAREA":return b(e,o,n);default:return null}})}):null}),ae=U(({slots:r,name:$,loading:T,children:I,className:s="defaultForm",fieldsConfig:p,onSubmit:i,handleSetCountryCode:t,onChange:S})=>{const{formData:A,errors:f,formRef:D,handleInputChange:b,handleFormChange:e,handleBlur:n,handleSubmit:o}=Y({fieldsConfig:p,onSubmit:i,handleSetCountryCode:t,onChange:S});return R("form",{className:y(["dropin-form",s]),onSubmit:o,onChange:e,name:$,ref:D,children:[a(m,{className:s,loading:T,fields:p,onChange:b,onBlur:n,errors:f,values:A}),r!=null&&r.AddressFormInputs?a(g,{"data-testid":"addressFormInputs",name:"AddressFormInputs",slot:r.AddressFormInputs,context:{formActions:{handleChange:b}}}):null,I]})}),te=({testId:r,withCard:$=!0})=>{const T=R(q,{"data-testid":r||"skeletonLoader",children:[a(E,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(E,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(E,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return $?T:a(j,{variant:"secondary",className:y(["dropin-account-loaders","dropin-account-loaders--card-loader"]),children:T})},le=()=>R(q,{"data-testid":"addressFormLoader",children:[a(E,{variant:"heading",size:"medium"}),a(E,{variant:"empty",size:"medium"}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large",fullWidth:!0}),a(E,{size:"large",fullWidth:!0,lines:3}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large"}),a(E,{size:"large",fullWidth:!0})]}),_={entityType:"CUSTOMER_ADDRESS",isUnique:!1,options:[],multilineCount:0,validateRules:[],defaultValue:!1,fieldType:N.BOOLEAN,className:"",required:!1,orderNumber:90,isHidden:!1},de={..._,label:"Set as default shipping address",name:"default_shipping",id:"default_shipping",code:"default_shipping",customUpperCode:"defaultShipping"},se={..._,label:"Set as default billing address",name:"default_billing",id:"default_billing",code:"default_billing",customUpperCode:"defaultBilling"};export{le as A,te as C,ae as F,se as a,de as d};
