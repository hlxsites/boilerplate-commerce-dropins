import{jsx as a,Fragment as H,jsxs as v}from"@dropins/tools/preact-jsx-runtime.js";import{useRef as W,useState as O,useEffect as V,useCallback as L}from"@dropins/tools/preact-hooks.js";import{useText as G}from"@dropins/tools/i18n.js";import{classes as A,Slot as g}from"@dropins/tools/lib.js";import{memo as q,useCallback as S}from"@dropins/tools/preact-compat.js";import{Field as M,Picker as P,Input as m,InputDate as X,Checkbox as w,TextArea as C,Skeleton as R,SkeletonRow as i,Card as B}from"@dropins/tools/components.js";const U=r=>r.reduce(($,{code:T,required:I,defaultValue:s})=>(I&&T&&(typeof s=="string"||typeof s=="number"||typeof s=="boolean")&&($[T]=s),$),{}),j=({fieldsConfig:r,onSubmit:$,handleSetCountryCode:T,onChange:I})=>{const{requiredFieldError:s}=G({requiredFieldError:"Account.FormText.requiredFieldError"}),h=W(null),[p,t]=O({}),[z,D]=O({});V(()=>{if(!r||!r.length)return;const l=U(r);t(l)},[r==null?void 0:r.length]);const[f,x]=O({previousCountryCode:null,previousRegionCode:null,initialLoad:!0});V(()=>{var E;const l=p.country_code,d=r==null?void 0:r.find(u=>u.code==="region");if(f.initialLoad)x(u=>({...u,previousCountryCode:l,initialLoad:!1}));else if(f.previousCountryCode!==l){x(c=>({...c,previousCountryCode:l}));const u=!((E=d==null?void 0:d.options)!=null&&E.length)&&!(d!=null&&d.defaultValue)||f.previousRegionCode?"":(d==null?void 0:d.defaultValue)??"";t(c=>({...c,region:u})),T(l)}d!=null&&d.defaultValue&&f.previousCountryCode===l&&x(u=>({...u,previousRegionCode:d.defaultValue}))},[r,p,f.previousCountryCode,f.initialLoad,f.previousRegionCode,T,t]),V(()=>{if(!(r!=null&&r.length))return;const l=U(r);t(l)},[r==null?void 0:r.length]);const b=L((l,d)=>{const E=r.find(u=>u.code===l);return E!=null&&E.required&&!d?s:""},[r,s]),e=L(l=>{const{name:d,value:E,type:u,checked:c}=l==null?void 0:l.target,y=u==="checkbox"?c:E;t(N=>({...N,[d]:y}))},[]),n=L(l=>{const d=l.currentTarget,E=l.target,u=new FormData(d),c=Object.fromEntries(u.entries()),y={[E.name]:c[E.name]&&String(c[E.name])};I==null||I(c,y,l)},[I]),o=L(l=>{const{name:d,value:E,type:u,checked:c}=l==null?void 0:l.target,y=u==="checkbox"?c:E;D(N=>({...N,[d]:b(d,y)}))},[b]),F=L(l=>{l.preventDefault();let d=!0,E={},u=null;for(const[c,y]of Object.entries(p)){const N=b(c,y);N&&(E[c]=N,d=!1,u||(u=c))}if(D(E),u&&h.current){const c=h.current.elements.namedItem(u);c==null||c.focus()}$==null||$(l,d)},[p,b,$]);return{formData:p,errors:z,formRef:h,handleInputChange:e,handleFormChange:n,handleBlur:o,handleSubmit:F}};var k=(r=>(r.BOOLEAN="BOOLEAN",r.DATE="DATE",r.DATETIME="DATETIME",r.DROPDOWN="DROPDOWN",r.FILE="FILE",r.GALLERY="GALLERY",r.HIDDEN="HIDDEN",r.IMAGE="IMAGE",r.MEDIA_IMAGE="MEDIA_IMAGE",r.MULTILINE="MULTILINE",r.MULTISELECT="MULTISELECT",r.PRICE="PRICE",r.SELECT="SELECT",r.TEXT="TEXT",r.TEXTAREA="TEXTAREA",r.UNDEFINED="UNDEFINED",r.VISUAL="VISUAL",r.WEIGHT="WEIGHT",r.EMPTY="",r))(k||{});const Y=q(({loading:r,values:$,fields:T=[],errors:I,className:s="",onChange:h,onBlur:p})=>{const t=`${s}__field`,z=S((e,n,o)=>a(M,{error:o,className:A([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(P,{name:e.id,floatingLabel:`${e.label} ${e.required?"*":""}`,placeholder:e.label,"aria-label":e.label,options:e.options,onBlur:p,handleSelect:h,value:n||e.defaultValue})},e.id),[s,r,t,p,h]),D=S((e,n,o)=>a(M,{error:o,className:A([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(m,{type:"text",name:e.id,value:n??e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:p,onChange:h})},e.id),[s,r,t,p,h]),f=S((e,n,o)=>a(M,{error:o,className:A([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(X,{type:"text",name:e.id,value:n||e.defaultValue,placeholder:e.label,floatingLabel:`${e.label} ${e.required?"*":""}`,onBlur:p,onChange:h})},e.id),[s,r,t,p,h]),x=S((e,n,o)=>a(M,{error:o,className:A([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(w,{name:e.id,checked:n||e.defaultValue,placeholder:e.label,label:`${e.label} ${e.required?"*":""}`,onBlur:p,onChange:h})},e.id),[s,r,t,p,h]),b=S((e,n,o)=>a(M,{error:o,className:A([t,`${t}--${e.id}`,[`${t}--${e.id}-hidden`,e.isHidden],e.className]),"data-testid":`${s}--${e.id}`,disabled:r,children:a(C,{type:"text",name:e.id,value:n??e.defaultValue,label:`${e.label} ${e.required?"*":""}`,onBlur:p,onChange:h})},e.id),[s,r,t,p,h]);return T.length?a(H,{children:T.map(e=>{const n=I==null?void 0:I[e.id],o=$==null?void 0:$[e.id];switch(e.fieldType){case k.TEXT:return e.options.length?z(e,o,n):D(e,o,n);case k.MULTILINE:return D(e,o,n);case k.SELECT:return z(e,o,n);case k.DATE:return f(e,o,n);case k.BOOLEAN:return x(e,o,n);case"TEXTAREA":return b(e,o,n);default:return null}})}):null}),ae=q(({slots:r,name:$,loading:T,children:I,className:s="defaultForm",fieldsConfig:h,onSubmit:p,handleSetCountryCode:t,onChange:z})=>{const{formData:D,errors:f,formRef:x,handleInputChange:b,handleFormChange:e,handleBlur:n,handleSubmit:o}=j({fieldsConfig:h,onSubmit:p,handleSetCountryCode:t,onChange:z});return v("form",{className:A(["dropin-form",s]),onSubmit:o,onChange:e,name:$,ref:x,children:[a(Y,{className:s,loading:T,fields:h,onChange:b,onBlur:n,errors:f,values:D}),r!=null&&r.AddressFormInputs?a(g,{"data-testid":"addressFormInputs",name:"AddressFormInputs",slot:r.AddressFormInputs,context:{formActions:{handleChange:b}}}):null,I]})}),te=({testId:r,withCard:$=!0})=>{const T=v(R,{"data-testid":r||"skeletonLoader",children:[a(i,{variant:"heading",size:"xlarge",fullWidth:!1,lines:1}),a(i,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1}),a(i,{variant:"heading",size:"xlarge",fullWidth:!0,lines:1})]});return $?T:a(B,{variant:"secondary",className:A(["dropin-account-loaders","dropin-account-loaders--card-loader"]),children:T})},le=()=>v(R,{"data-testid":"addressFormLoader",children:[a(i,{variant:"heading",size:"medium"}),a(i,{variant:"empty",size:"medium"}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large",fullWidth:!0}),a(i,{size:"large",fullWidth:!0,lines:3}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large"}),a(i,{size:"large",fullWidth:!0})]}),de=r=>v(R,{...r,rowGap:"xsmall",className:A(["dropin-account-loaders","dropin-account-loaders--picker-loader"]),children:[a(i,{variant:"heading",size:"xsmall"}),a(i,{variant:"empty",size:"small"}),a(i,{size:"small"})]}),_={entityType:"CUSTOMER_ADDRESS",isUnique:!1,options:[],multilineCount:0,validateRules:[],defaultValue:!1,fieldType:k.BOOLEAN,className:"",required:!1,orderNumber:90,isHidden:!1},se={..._,label:"Set as default shipping address",name:"default_shipping",id:"default_shipping",code:"default_shipping",customUpperCode:"defaultShipping"},ne={..._,label:"Set as default billing address",name:"default_billing",id:"default_billing",code:"default_billing",customUpperCode:"defaultBilling"};export{le as A,te as C,ae as F,de as P,ne as a,se as d};
