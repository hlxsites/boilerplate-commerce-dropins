import{jsx as t,jsxs as c,Fragment as b}from"@dropins/tools/preact-jsx-runtime.js";import{classes as C,Slot as k}from"@dropins/tools/lib.js";import{C as x}from"../chunks/AddressFormWrapper2.js";import"@dropins/tools/preact-compat.js";import{Card as H,Icon as v,Image as E,Header as S}from"@dropins/tools/components.js";import{c as A,S as N,E as w}from"../chunks/checkIsFunction.js";import{useCallback as T,useState as f,useEffect as _}from"@dropins/tools/preact-hooks.js";import{useText as O}from"@dropins/tools/i18n.js";import"@dropins/tools/preact.js";import"@dropins/tools/event-bus.js";import{g as $}from"../chunks/getOrderHistoryList.js";import"../chunks/convertCase.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-customer-address.js";const y={size:"32",stroke:"2"},I=({routeOrdersList:r,onSelectId:s,selectedId:d="",minifiedView:i,redirectButtonText:h})=>{const l=O({viewAllOrders:"Account.OrdersList.viewAllOrders"}),n=A(r)?r():"#",e=T(p=>{A(r)||(p.preventDefault(),s&&d&&(s==null||s(d)))},[s,r,d]);return i?t("a",{className:C(["dropin-orders-list-action",["dropin-orders-list-action--minifiedView",i]]),"data-testid":"ordersListActionButtonMinifiedView",href:n,onClick:e,children:t(H,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:c("div",{className:"dropin-orders-list-action__card-wrapper",children:[c("p",{children:[" ",h||l.viewAllOrders]}),t(v,{source:N,...y})]})})}):t("a",{href:n,onClick:e,className:"dropin-orders-list-action","data-testid":"ordersListActionButton",children:t(v,{source:N,...y})})},j=({item:r,withThumbnails:s,children:d,slots:i,...h})=>{var n,e,p,L;const l=O({orderNumber:"Account.OrdersListCard.orderNumber",itemsLength:"Account.OrdersListCard.itemsLength"});return c(H,{...h,className:C(["dropin-orders-list-card",["dropin-orders-list-card--full",((n=r==null?void 0:r.items)==null?void 0:n.length)>6]]),variant:"secondary",children:[t("div",{className:"dropin-orders-list-card--content",children:i!=null&&i.OrdersListCard?t(k,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:i==null?void 0:i.OrdersListCard,context:{orderHistoryListItem:r}}):c(b,{children:[t("div",{children:r==null?void 0:r.status}),t("p",{children:r==null?void 0:r.orderDate}),c("p",{children:[l.orderNumber," ",r.number]}),c("p",{children:["$",(e=r==null?void 0:r.total)==null?void 0:e.grandTotal.value]}),c("p",{children:[(p=r==null?void 0:r.items)==null?void 0:p.length," ",l.itemsLength]})]})}),s&&((L=r==null?void 0:r.items)!=null&&L.length)?t("div",{className:"dropin-orders-list-card--images","data-testid":"ordersListCardImages",children:r.items.map((a,u)=>{var m;const o=(m=a==null?void 0:a.product)==null?void 0:m.smallImage.url,g=a==null?void 0:a.productName;return t(E,{src:o,width:65,height:65,alt:g},a.id+u)})}):null,t("div",{className:"dropin-orders-list-card--actions",children:d})]})},B=({ordersInMinifiedView:r,minifiedView:s,pageSize:d})=>{const[i,h]=f([]),[l,n]=f({}),[e,p]=f(""),[L,a]=f(!1);_(()=>{a(!0),$(s?r:d).then(o=>{!o||!o.items||(n(o.pageInfo),h(o.items))}).finally(()=>{a(!1)})},[s,r,d]);const u=T(o=>{p(o)},[]);return{loading:L,orderHistoryListItems:i,pageInfo:l,selectedId:e,handleSelectId:u}},Y=({className:r,slots:s,minifiedView:d=!1,withThumbnails:i=!0,ordersInMinifiedView:h=1,pageSize:l=10,redirectButtonText:n,routeOrdersList:e})=>{const p=O({settingsOrderListTitle:"Account.ContainersTitle.settingsOrderListTitle"}),{loading:L,orderHistoryListItems:a,handleSelectId:u}=B({minifiedView:d,pageSize:l,ordersInMinifiedView:h});return c("div",{children:[d?null:t(S,{title:p.settingsOrderListTitle}),c("div",{className:C(["dropin-orders-list",r]),children:[L?t(x,{testId:"orderSkeletonLoader",withCard:!1}):t(w,{isEmpty:!a.length,typeList:"orders"}),a.map((o,g)=>t(j,{item:o,withThumbnails:i,slots:s,children:s!=null&&s.OrdersListAction?t(k,{"data-testid":`ordersListActionSlot_${g}`,name:"OrdersListAction",slot:s==null?void 0:s.OrdersListAction,context:{handleSelectId:u,orderHistoryListItem:o}}):t(I,{onSelectId:u,selectedId:o.id})},g)),d?t(I,{minifiedView:d,onSelectId:u,routeOrdersList:e,redirectButtonText:n}):null]})]})};export{Y as OrdersList,Y as default};
