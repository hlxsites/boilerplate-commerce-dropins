import{jsx as i,jsxs as p,Fragment as z}from"@dropins/tools/preact-jsx-runtime.js";import{classes as w,Slot as S}from"@dropins/tools/lib.js";import{C as k}from"../chunks/AddressFormWrapper2.js";import"@dropins/tools/preact-compat.js";import{Card as y,Icon as C,Image as T,Header as b}from"@dropins/tools/components.js";import{S as v,c as H,E as x}from"../chunks/checkIsFunction.js";import{useCallback as I,useState as A,useEffect as B}from"@dropins/tools/preact-hooks.js";import{useText as h}from"@dropins/tools/i18n.js";import"@dropins/tools/preact.js";import"@dropins/tools/event-bus.js";import{g as E}from"../chunks/getOrderHistoryList.js";import"../chunks/convertCase.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/transform-customer-address.js";const N={size:"32",stroke:"2"},V=({minifiedView:n,orderId:r,orderToken:t,onSelectId:o,routeOrdersList:e,routeOrderDetails:f})=>{const s={minifiedView:{},fullSizeView:{}};s.minifiedView=h({viewAllOrdersButton:"Account.OrdersList.minifiedView.viewAllOrdersButton"});const l=I(()=>{o&&r&&(o==null||o(r))},[o,r]);return e?i("a",{className:w(["dropin-orders-list-action",["dropin-orders-list-action--minifiedView",n]]),"data-testid":"ordersListActionButtonMinifiedView",href:e(),onClick:l,children:i(y,{"data-testid":"ordersListActionMinifiedView",variant:"secondary",children:p("div",{className:"dropin-orders-list-action__card-wrapper",children:[i("p",{children:s.minifiedView.viewAllOrdersButton}),i(C,{source:v,...N})]})})}):i("a",{href:H(f)?f(r,t):"#",onClick:l,className:"dropin-orders-list-action","data-testid":"ordersListActionButton",children:i(C,{source:v,...N})})},_=({minifiedView:n,item:r,withThumbnails:t,children:o,slots:e,...f})=>{var l,d,u,L;const s={minifiedView:{},fullSizeView:{}};return s.minifiedView=h({orderNumber:"Account.OrdersList.minifiedView.OrdersListCard.orderNumber",itemsAmount:"Account.OrdersList.minifiedView.OrdersListCard.itemsAmount"}),s.fullSizeView=h({orderNumber:"Account.OrdersList.fullSizeView.OrdersListCard.orderNumber",itemsAmount:"Account.OrdersList.fullSizeView.OrdersListCard.itemsAmount"}),p(y,{...f,className:w(["dropin-orders-list-card",["dropin-orders-list-card--full",((l=r==null?void 0:r.items)==null?void 0:l.length)>6]]),variant:"secondary",children:[i("div",{className:"dropin-orders-list-card--content",children:e!=null&&e.OrdersListCard?i(S,{"data-testid":`ordersListCard${r.id}`,name:"OrdersListCard",slot:e==null?void 0:e.OrdersListCard,context:{orderHistoryListItem:r}}):p(z,{children:[i("div",{children:r==null?void 0:r.status}),i("p",{children:r==null?void 0:r.orderDate}),p("p",{children:[n?s.minifiedView.orderNumber:s.fullSizeView.orderNumber," ",r.number]}),p("p",{children:["$",(d=r==null?void 0:r.total)==null?void 0:d.grandTotal.value]}),p("p",{children:[(u=r==null?void 0:r.items)==null?void 0:u.length," ",n?s.minifiedView.itemsAmount:s.fullSizeView.itemsAmount]})]})}),t&&((L=r==null?void 0:r.items)!=null&&L.length)?i("div",{className:"dropin-orders-list-card--images","data-testid":"ordersListCardImages",children:r.items.map((a,c)=>{var g;const m=(g=a==null?void 0:a.product)==null?void 0:g.smallImage.url,O=a==null?void 0:a.productName;return i(T,{src:m,width:65,height:65,alt:O},a.id+c)})}):null,i("div",{className:"dropin-orders-list-card--actions",children:o})]})},$=({ordersInMinifiedView:n,minifiedView:r,pageSize:t})=>{const[o,e]=A([]),[f,s]=A({}),[l,d]=A(""),[u,L]=A(!1);B(()=>{L(!0),E(r?n:t).then(c=>{!c||!c.items||(s(c.pageInfo),e(c.items))}).finally(()=>{L(!1)})},[r,n,t]);const a=I(c=>{d(c)},[]);return{loading:u,orderHistoryListItems:o,pageInfo:f,selectedId:l,handleSelectId:a}},j=({className:n,withHeader:r=!0,minifiedView:t=!1,withThumbnails:o=!0,ordersInMinifiedView:e=1,pageSize:f=10,routeOrdersList:s,routeOrderDetails:l,slots:d})=>{const u={minifiedView:{},fullSizeView:{}};u.minifiedView=h({containerTitle:"Account.OrdersList.minifiedView.containerTitle"}),u.fullSizeView=h({containerTitle:"Account.OrdersList.fullSizeView.containerTitle"});const{loading:L,orderHistoryListItems:a,handleSelectId:c}=$({minifiedView:t,pageSize:f,ordersInMinifiedView:e});return p("div",{children:[r?i(b,{title:t?u.minifiedView.containerTitle:u.fullSizeView.containerTitle,divider:!t,className:t?"dropin-orders-list-header":""}):null,p("div",{className:w(["dropin-orders-list",n]),children:[L?i(k,{testId:"orderSkeletonLoader",withCard:!1}):i(x,{isEmpty:!a.length,typeList:"orders",minifiedView:t}),a.map((m,O)=>i(_,{minifiedView:t,item:m,withThumbnails:o,slots:d,children:d!=null&&d.OrdersListAction?i(S,{"data-testid":`ordersListActionSlot_${O}`,name:"OrdersListAction",slot:d==null?void 0:d.OrdersListAction,context:{handleSelectId:c,orderHistoryListItem:m}}):i(V,{minifiedView:t,onSelectId:c,orderId:m.id,orderToken:m.token,routeOrderDetails:l})},O)),t?i(V,{minifiedView:t,onSelectId:c,routeOrdersList:s}):null]})]})},Z=({className:n,withHeader:r,minifiedView:t,withThumbnails:o,withFilter:e,ordersInMinifiedView:f,pageSize:s,routeOrdersList:l,routeOrderDetails:d,slots:u})=>i("div",{className:w(["dropin-orders-list",n]),"data-testid":"ordersListId",children:i(j,{className:n,withHeader:r,minifiedView:t,withThumbnails:o,withFilter:e,ordersInMinifiedView:f,pageSize:s,routeOrdersList:l,routeOrderDetails:d,slots:u})});export{Z as OrdersList,Z as default};
