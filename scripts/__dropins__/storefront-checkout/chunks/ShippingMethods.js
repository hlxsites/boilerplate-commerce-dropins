import{jsx as n,jsxs as j,Fragment as B}from"@dropins/tools/preact-jsx-runtime.js";import{e as O}from"./getMultilineValues.js";import{events as T}from"@dropins/tools/event-bus.js";import{w as P,x as L,n as w,q,y as V}from"./fixtures.js";import{s as Z}from"./setShippingMethods.js";import{classes as W}from"@dropins/tools/lib.js";import{H as $}from"./ToggleButton.js";import{IllustratedMessage as F,Icon as G,ProgressSpinner as J,RadioButton as K,Price as Q,Divider as X,Skeleton as Y,SkeletonRow as y}from"@dropins/tools/components.js";import{useState as I,useEffect as x}from"@dropins/tools/preact-hooks.js";/* empty css                     */import*as a from"@dropins/tools/preact-compat.js";import{useCallback as D,useMemo as U,useEffect as A}from"@dropins/tools/preact-compat.js";import{useText as ee}from"@dropins/tools/i18n.js";const v=P(void 0),te=e=>({countryCode:e.country_id,postCode:e.postcode||"",...e.region_id?{regionId:Number(e.region_id)}:{...e.region?{region:e.region}:{}}}),ne=e=>({carrierCode:e.carrier.code||"",methodCode:e.code||"",amount:e.amount,amountExclTax:e.amountExclTax,amountInclTax:e.amountInclTax}),oe=e=>a.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...e},a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.47266 4.90002H15.1851V10.9645H21.2495L23 12.715V17.6124H20.073",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M15.1758 5.87573H19.0019L21.0394 10.7636",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76151 16.7898C9.76151 18.0525 8.72845 19.076 7.46582 19.076C6.20318 19.076 5.17969 18.0429 5.17969 16.7803C5.17969 15.5176 6.20318 14.4941 7.46582 14.4941C8.72845 14.4941 9.75195 15.5176 9.76151 16.7803C9.76151 16.7803 9.76151 16.7803 9.76151 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M19.8726 16.7898C19.8726 18.062 18.8491 19.0855 17.5769 19.0855C16.3047 19.0855 15.2812 18.062 15.2812 16.7898C15.2812 15.5176 16.3047 14.4941 17.5769 14.4941C18.8491 14.4941 19.8726 15.5176 19.8726 16.7898Z",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M8.08792 7.63574H1.69824",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M7.11229 10.3619H1",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M5.16084 13.0402H1.92773",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M9.76172 16.7611H15.2809",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"}),a.createElement("path",{vectorEffect:"non-scaling-stroke",d:"M2.38672 16.7611H5.17025",stroke:"currentColor",strokeWidth:1,strokeLinecap:"round",strokeLinejoin:"round"})),ie=({className:e,isLoading:t=!1,onSelectionChange:r=()=>{},options:s,selection:o,...m})=>{const u=ee({Title:"Checkout.ShippingMethods.title",EmptyState:"Checkout.ShippingMethods.emptyState"});return s===void 0?n(re,{}):j("div",{...m,className:W(["checkout-shipping-methods",e]),children:[n($,{level:3,className:"checkout-shipping-methods__title",children:u.Title}),!t&&s.length===0&&n(F,{icon:n(G,{source:oe}),message:n("p",{children:u.EmptyState})}),j("div",{className:W(["checkout-shipping-methods__content"]),children:[t&&n(J,{className:"checkout-shipping-methods__spinner"}),n("div",{className:W(["checkout-shipping-methods__options",["checkout-shipping-methods__options--loading",t]]),children:s.map(i=>n(K,{"data-testid":"shipping-method-radiobutton","aria-busy":t,id:i.value,name:"shipping-method",className:"checkout-shipping-methods__method",label:j(B,{children:[n(Q,{amount:i.amount.value,currency:i.amount.currency}),"Â ",n("span",{children:i.carrier.title})]}),description:i.title,value:i.value,checked:(o==null?void 0:o.value)===i.value,onChange:()=>r(i)},i.value))})]}),n(X,{variant:"primary"})]})},re=()=>j(Y,{"data-testid":"shipping-methods-skeleton",children:[n(y,{variant:"heading",size:"small"}),n(y,{variant:"empty",size:"small"}),n(y,{size:"medium",fullWidth:!0}),n(y,{size:"medium",fullWidth:!0})]});function se(){var c;const[e,t]=I(),[r,s]=I();x(()=>{T.on("checkout/address",({address:M,type:S})=>{S==="shipping"&&t(M)})},[]),x(()=>{s(v.value)},[v.value]),x(()=>{L.value.pending?s(void 0):s(v.value)},[L.value.pending]);const{country_id:o,region_id:m,region:u,postcode:i}=e||{},p=!!e,f=w.value.data,k=!!((c=f==null?void 0:f.shippingAddresses)!=null&&c[0]);x(()=>{k||!r||!p||T.emit("shipping/estimate",{address:te({country_id:o,region_id:m,region:u,postcode:i}),shippingMethod:ne(r)})},[r,o,m,u,i,p,k])}const b=(e,t)=>e.code===t.code&&e.carrier.code===t.carrier.code;function ce({onCheckoutDataUpdate:e,preSelectedMethod:t}){const r=q.value.data,s=!r,o=w.value.data,m=w.value.pending,u=L.value.data,i=L.value.pending,p=v.value,f=o==null?void 0:o.id,k=o==null?void 0:o.shippingAddresses,c=k==null?void 0:k[0],M=!!c,S=c==null?void 0:c.availableShippingMethods,E=c==null?void 0:c.selectedShippingMethod,d=S||u,N=D(l=>{if(!M)return;const g={method_code:l.code,carrier_code:l.carrier.code};Z([g]).then(()=>{e==null||e()}).catch(_=>{console.error("setting shipping methods on cart failed:",_)})},[M,e]),R=l=>{v.value=l},h=U(()=>{if(!(d!=null&&d.length))return;const l=d[0],g=p||E;return g?d.some(C=>b(C,g))?g:l:d.find(H=>H.carrier.code===(t==null?void 0:t.carrierCode)&&H.code===(t==null?void 0:t.methodCode))||l},[p,E,d,t]);return A(()=>{h&&((!p||!b(h,p))&&(v.value=h),(!E||!b(h,E))&&N(h))},[h,p,E,N]),A(()=>{if(!f||S)return;const{country:l,selectedRegion:g,selectedRegionId:_}=V.value,C=l||(r==null?void 0:r.defaultCountry);C&&O({criteria:{country_code:C,region_name:g,region_id:_}}).catch(z=>{L.value={pending:!1,data:[]},console.error("shipping methods estimation failed:",z)})},[f,S,r]),{isLoading:m||s||i,options:d,selection:h,onSelectionChange:R}}const Ee=e=>{const{isLoading:t,options:r,selection:s,onSelectionChange:o}=ce(e);return se(),n(ie,{...e,className:"checkout-shipping-methods",isLoading:t,onSelectionChange:o,options:r,selection:s})};export{Ee as S};
