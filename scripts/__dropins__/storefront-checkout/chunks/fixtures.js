import{events as k}from"@dropins/tools/event-bus.js";import{Component as V,options as O,isValidElement as z}from"@dropins/tools/preact.js";import{useMemo as $}from"@dropins/tools/preact-hooks.js";import{FetchGraphQL as Y}from"@dropins/tools/fetch-graphql.js";class J extends Error{constructor(i){super(i.map(t=>t.message).join(" ")),this.name="FetchError"}}class m extends Error{constructor(i){super(i),this.name="InvalidArgument"}}class Me extends Error{constructor(i){super(i),this.name="UnexpectedError"}}class Ue extends m{constructor(){super("Cart ID is required")}}class we extends m{constructor(){super("Email is required")}}class Ge extends m{constructor(){super("Payment method code is required")}}class Le extends m{constructor(){super("Billing address is required")}}class Ae extends m{constructor(){super("Country Code is required")}}const D=[];function K(e){return new Promise((i,t)=>{D.push(e);const r=()=>{D[0]===e?e().then(i).catch(t).finally(()=>D.shift()):setTimeout(r,100)};r()})}const ee=["sender_email","recipient_email"];function ie(e){return e.filter(i=>!i.path||!ee.some(t=>{var r;return((r=i.path)==null?void 0:r.at(-1))===t}))}const R=e=>{throw e instanceof DOMException&&e.name==="AbortError"||k.emit("error",{source:"checkout",type:"network",error:e}),e};var te=Symbol.for("preact-signals");function w(){if(g>1)g--;else{for(var e,i=!1;E!==void 0;){var t=E;for(E=void 0,U++;t!==void 0;){var r=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&F(t))try{t.c()}catch(o){i||(e=o,i=!0)}t=r}}if(U=0,g--,i)throw e}}var n=void 0,E=void 0,g=0,U=0,I=0;function P(e){if(n!==void 0){var i=e.n;if(i===void 0||i.t!==n)return i={i:0,S:e,p:n.s,n:void 0,t:n,e:void 0,x:void 0,r:i},n.s!==void 0&&(n.s.n=i),n.s=i,e.n=i,32&n.f&&e.S(i),i;if(i.i===-1)return i.i=0,i.n!==void 0&&(i.n.p=i.p,i.p!==void 0&&(i.p.n=i.n),i.p=n.s,i.n=void 0,n.s.n=i,n.s=i),i}}function l(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}l.prototype.brand=te;l.prototype.h=function(){return!0};l.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};l.prototype.U=function(e){if(this.t!==void 0){var i=e.e,t=e.x;i!==void 0&&(i.x=t,e.e=void 0),t!==void 0&&(t.e=i,e.x=void 0),e===this.t&&(this.t=t)}};l.prototype.subscribe=function(e){var i=this;return x(function(){var t=i.value,r=n;n=void 0;try{e(t)}finally{n=r}})};l.prototype.valueOf=function(){return this.value};l.prototype.toString=function(){return this.value+""};l.prototype.toJSON=function(){return this.value};l.prototype.peek=function(){var e=n;n=void 0;try{return this.value}finally{n=e}};Object.defineProperty(l.prototype,"value",{get:function(){var e=P(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(U>100)throw new Error("Cycle detected");this.v=e,this.i++,I++,g++;try{for(var i=this.t;i!==void 0;i=i.x)i.t.N()}finally{w()}}}});function d(e){return new l(e)}function F(e){for(var i=e.s;i!==void 0;i=i.n)if(i.S.i!==i.i||!i.S.h()||i.S.i!==i.i)return!0;return!1}function H(e){for(var i=e.s;i!==void 0;i=i.n){var t=i.S.n;if(t!==void 0&&(i.r=t),i.S.n=i,i.i=-1,i.n===void 0){e.s=i;break}}}function W(e){for(var i=e.s,t=void 0;i!==void 0;){var r=i.p;i.i===-1?(i.S.U(i),r!==void 0&&(r.n=i.n),i.n!==void 0&&(i.n.p=r)):t=i,i.S.n=i.r,i.r!==void 0&&(i.r=void 0),i=r}e.s=t}function y(e){l.call(this,void 0),this.x=e,this.s=void 0,this.g=I-1,this.f=4}(y.prototype=new l).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===I))return!0;if(this.g=I,this.f|=1,this.i>0&&!F(this))return this.f&=-2,!0;var e=n;try{H(this),n=this;var i=this.x();(16&this.f||this.v!==i||this.i===0)&&(this.v=i,this.f&=-17,this.i++)}catch(t){this.v=t,this.f|=16,this.i++}return n=e,W(this),this.f&=-2,!0};y.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var i=this.s;i!==void 0;i=i.n)i.S.S(i)}l.prototype.S.call(this,e)};y.prototype.U=function(e){if(this.t!==void 0&&(l.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var i=this.s;i!==void 0;i=i.n)i.S.U(i)}};y.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(y.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=P(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function re(e){return new y(e)}function B(e){var i=e.u;if(e.u=void 0,typeof i=="function"){g++;var t=n;n=void 0;try{i()}catch(r){throw e.f&=-2,e.f|=8,G(e),r}finally{n=t,w()}}}function G(e){for(var i=e.s;i!==void 0;i=i.n)i.S.U(i);e.x=void 0,e.s=void 0,B(e)}function se(e){if(n!==this)throw new Error("Out-of-order effect");W(this),n=e,this.f&=-2,8&this.f&&G(this),w()}function C(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}C.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var i=this.x();typeof i=="function"&&(this.u=i)}finally{e()}};C.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,B(this),H(this),g++;var e=n;return n=this,se.bind(this,e)};C.prototype.N=function(){2&this.f||(this.f|=2,this.o=E,E=this)};C.prototype.d=function(){this.f|=8,1&this.f||G(this)};function x(e){var i=new C(e);try{i.c()}catch(t){throw i.d(),t}return i.d.bind(i)}var M;function S(e,i){O[e]=i.bind(null,O[e]||function(){})}function N(e){M&&M(),M=e&&e.S()}function Q(e){var i=this,t=e.data,r=ne(t);r.value=t;var o=$(function(){for(var s=i.__v;s=s.__;)if(s.__c){s.__c.__$f|=4;break}return i.__$u.c=function(){var a;!z(o.peek())&&((a=i.base)==null?void 0:a.nodeType)===3?i.base.data=o.peek():(i.__$f|=1,i.setState({}))},re(function(){var a=r.value.value;return a===0?0:a===!0?"":a||""})},[]);return o.value}Q.displayName="_st";Object.defineProperties(l.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Q},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});S("__b",function(e,i){if(typeof i.type=="string"){var t,r=i.props;for(var o in r)if(o!=="children"){var s=r[o];s instanceof l&&(t||(i.__np=t={}),t[o]=s,r[o]=s.peek())}}e(i)});S("__r",function(e,i){N();var t,r=i.__c;r&&(r.__$f&=-2,(t=r.__$u)===void 0&&(r.__$u=t=function(o){var s;return x(function(){s=this}),s.c=function(){r.__$f|=1,r.setState({})},s}())),N(t),e(i)});S("__e",function(e,i,t,r){N(),e(i,t,r)});S("diffed",function(e,i){N();var t;if(typeof i.type=="string"&&(t=i.__e)){var r=i.__np,o=i.props;if(r){var s=t.U;if(s)for(var a in s){var u=s[a];u!==void 0&&!(a in r)&&(u.d(),s[a]=void 0)}else t.U=s={};for(var f in r){var p=s[f],v=r[f];p===void 0?(p=oe(t,f,v,o),s[f]=p):p.o(v,o)}}}e(i)});function oe(e,i,t,r){var o=i in e&&e.ownerSVGElement===void 0,s=d(t);return{o:function(a,u){s.value=a,r=u},d:x(function(){var a=s.value.value;r[i]!==a&&(r[i]=a,o?e[i]=a:a?e.setAttribute(i,a):e.removeAttribute(i))})}}S("unmount",function(e,i){if(typeof i.type=="string"){var t=i.__e;if(t){var r=t.U;if(r){t.U=void 0;for(var o in r){var s=r[o];s&&s.d()}}}}else{var a=i.__c;if(a){var u=a.__$u;u&&(a.__$u=void 0,u.d())}}e(i)});S("__h",function(e,i,t,r){(r<3||r===9)&&(i.__$f|=2),e(i,t,r)});V.prototype.shouldComponentUpdate=function(e,i){var t=this.__$u;if(!(t&&t.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var r in i)return!0;for(var o in e)if(o!=="__source"&&e[o]!==this.props[o])return!0;for(var s in this.props)if(!(s in e))return!0;return!1};function ne(e){return $(function(){return d(e)},[])}const ae=d({data:void 0,pending:!1}),le=d({checked:!0,setByUser:!1}),b=d({pending:!1,data:void 0});x(()=>{var e;(e=b.value.data)!=null&&e.isVirtual&&(le.value={checked:!1,setByUser:!1})});x(()=>{b.value.pending||k.emit("checkout/data",b.value.data||null)});const fe=d({data:void 0,pending:!1}),ue=d({pending:!1,data:void 0}),ce=d({pending:!1,data:void 0}),de=d({pending:!1,data:void 0}),he=d({data:void 0,pending:!1}),pe={cart:b,customer:ue,estimateShippingMethods:ce,regions:de,storeConfig:he,countryList:fe,addressFormFields:ae};function ve(e,i){return i.split(".").reduce((t,r)=>t&&t[r]!==void 0?t[r]:void 0,e)}const X={cart:null,customer:null,estimateShippingMethods:null,regions:null,storeConfig:null,countryList:null,addressFormFields:null};async function _e(e){const{defaultValueOnFail:i,query:t,options:r,path:o,signalType:s,type:a,transformer:u}=e,f=pe[s],p=Symbol();X[s]=p,f.value={...f.value,pending:!0};try{const{data:v,errors:L}=await(a==="mutation"?K(()=>q(t,r).catch(R)):q(t,{method:"GET",cache:"no-cache",...r}).catch(R));if(L){const A=ie(L);if(A.length>0)throw new J(A)}let T=ve(v,o);if(T===void 0)throw new Error(`No data found at path: ${o}`);return u&&(T=u(T)),f.value={...f.value,data:T},setTimeout(()=>{f.value={...f.value,pending:X[s]===p?!1:f.value.pending}},0),T}catch(v){if(i)return f.value={pending:!1,data:i},i;if(v.name==="AbortError")return;throw f.value={...f.value,pending:!1},v}}const ge={cartId:null,authenticated:!1},Oe=new Proxy(ge,{set(e,i,t){return e[i]=t,!0},get(e,i){return e[i]}}),ye=e=>e==null,Se=(e,i)=>e.amount.value-i.amount.value,j=e=>!(!e||!e.method_code||!e.method_title||ye(e.amount.value)||!e.amount.currency),Z=e=>({amount:{value:e.amount.value,currency:e.amount.currency},title:e.method_title,code:e.method_code,carrier:{code:e.carrier_code,title:e.carrier_title},value:`${e.carrier_code} - ${e.method_code}`,...e.price_excl_tax&&{amountExclTax:{value:e.price_excl_tax.value,currency:e.price_excl_tax.currency}},...e.price_incl_tax&&{amountInclTax:{value:e.price_incl_tax.value,currency:e.price_incl_tax.currency}}}),Re=e=>{if(j(e))return Z(e)},Xe=e=>{if(e)return e.filter(j).map(i=>Z(i)).sort(Se)},Te=`
  query getStoreConfig {
    storeConfig {
      countries_with_required_region
      default_country
      display_state_if_optional
      is_guest_checkout_enabled
      is_one_page_checkout_enabled
      locale
      optional_zip_countries
      shopping_cart_display_shipping
      store_code
    }
  }
`;var _=(e=>(e.EXCLUDING_TAX="EXCLUDING_TAX",e.INCLUDING_EXCLUDING_TAX="INCLUDING_AND_EXCLUDING_TAX",e.INCLUDING_TAX="INCLUDING_TAX",e))(_||{});const Ee="US",h={defaultCountry:Ee,countriesWithRequiredRegion:[],displayStateIfOptional:!1,countriesWithOptionalZipCode:[],isGuestCheckoutEnabled:!1,isOnePageCheckoutEnabled:!1,shoppingCartDisplaySetting:{shipping:_.EXCLUDING_TAX}},qe=async()=>await _e({type:"query",query:Te,options:{method:"GET",cache:"no-cache"},path:"storeConfig",signalType:"storeConfig",transformer:Ce,defaultValueOnFail:h});function me(e){switch(e){case 1:return _.EXCLUDING_TAX;case 2:return _.INCLUDING_TAX;case 3:return _.INCLUDING_EXCLUDING_TAX;default:return _.EXCLUDING_TAX}}function Ce(e){if(!e)return h;const{default_country:i,countries_with_required_region:t,display_state_if_optional:r,optional_zip_countries:o,is_guest_checkout_enabled:s,is_one_page_checkout_enabled:a,shopping_cart_display_shipping:u}=e;return{defaultCountry:i||h.defaultCountry,countriesWithRequiredRegion:(t==null?void 0:t.split(","))||h.countriesWithRequiredRegion,displayStateIfOptional:r||h.displayStateIfOptional,countriesWithOptionalZipCode:(o==null?void 0:o.split(","))||h.countriesWithOptionalZipCode,isGuestCheckoutEnabled:s||h.isGuestCheckoutEnabled,isOnePageCheckoutEnabled:a||h.isOnePageCheckoutEnabled,shoppingCartDisplaySetting:{shipping:me(u)}}}const{setEndpoint:ke,setFetchGraphQlHeader:$e,removeFetchGraphQlHeader:Pe,setFetchGraphQlHeaders:Fe,fetchGraphQl:q,getConfig:He}=new Y().getMethods();var c=(e=>(e.Boolean="BOOLEAN",e.Date="DATE",e.Datetime="DATETIME",e.File="FILE",e.Gallery="GALLERY",e.Hidden="HIDDEN",e.Image="IMAGE",e.MediaImage="MEDIA_IMAGE",e.Multiline="MULTILINE",e.Multiselect="MULTISELECT",e.Price="PRICE",e.Select="SELECT",e.Text="TEXT",e.Textarea="TEXTAREA",e.Undefined="UNDEFINED",e.Weight="WEIGHT",e))(c||{}),xe=(e=>(e.DateRangeMax="DATE_RANGE_MAX",e.DateRangeMin="DATE_RANGE_MIN",e.FileExtensions="FILE_EXTENSIONS",e.InputValidation="INPUT_VALIDATION",e.MaxFileSize="MAX_FILE_SIZE",e.MaxImageHeight="MAX_IMAGE_HEIGHT",e.MaxImageWidth="MAX_IMAGE_WIDTH",e.MaxTextLength="MAX_TEXT_LENGTH",e.MinTextLength="MIN_TEXT_LENGTH",e))(xe||{});const We=[{frontendInput:c.Text,code:"firstname",label:"First Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:10},{frontendInput:c.Text,code:"lastname",label:"Last Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:20},{frontendInput:c.Text,code:"company",label:"Company",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:30},{frontendInput:c.Multiline,code:"street",label:"Street Address",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:40},{frontendInput:c.Text,code:"city",label:"City",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:50},{frontendInput:c.Select,code:"country_id",label:"Country",isRequired:!0,isDisabled:!1,options:[{text:"United States",value:"US"},{text:"Spain",value:"ES"},{text:"France",value:"FR"}],validateRules:[],sortOrder:60},{frontendInput:c.Text,code:"region",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:70},{frontendInput:c.Hidden,code:"region_id",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:80},{frontendInput:c.Text,code:"postcode",label:"Zip/Postal Code",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:90},{frontendInput:c.Text,code:"telephone",label:"Phone Number",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:100},{frontendInput:c.Text,code:"vat_id",label:"VAT Number",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:110}];export{c as A,Ee as D,J as F,m as I,Ue as M,h as S,_ as T,Me as U,xe as V,we as a,Ge as b,Le as c,Ae as d,$e as e,Fe as f,q as g,He as h,We as i,qe as j,le as k,ae as l,ue as m,b as n,Oe as o,_e as p,he as q,Pe as r,ke as s,Xe as t,Re as u,R as v,d as w,ce as x,de as y,fe as z};
