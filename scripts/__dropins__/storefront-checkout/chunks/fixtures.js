import{events as A}from"@dropins/tools/event-bus.js";import{Component as Z,options as X,isValidElement as z}from"@dropins/tools/preact.js";import{useMemo as F}from"@dropins/tools/preact-hooks.js";import{FetchGraphQL as Y}from"@dropins/tools/fetch-graphql.js";class J extends Error{constructor(t){super(t.map(i=>i.message).join(" ")),this.name="FetchError"}}class C extends Error{constructor(t){super(t),this.name="InvalidArgument"}}class we extends Error{constructor(t){super(t),this.name="UnexpectedError"}}class Ge extends C{constructor(){super("Cart ID is required")}}class Le extends C{constructor(){super("Email is required")}}class Re extends C{constructor(){super("Payment method code is required")}}class qe extends C{constructor(){super("Billing address is required")}}class Xe extends C{constructor(){super("Country Code is required")}}const U=e=>{throw e instanceof DOMException&&e.name==="AbortError"||A.emit("error",{source:"checkout",type:"network",error:e}),e};var K=Symbol.for("preact-signals");function G(){if(y>1)y--;else{for(var e,t=!1;T!==void 0;){var i=T;for(T=void 0,O++;i!==void 0;){var r=i.o;if(i.o=void 0,i.f&=-3,!(8&i.f)&&P(i))try{i.c()}catch(o){t||(e=o,t=!0)}i=r}}if(O=0,y--,t)throw e}}var n=void 0,T=void 0,y=0,O=0,I=0;function $(e){if(n!==void 0){var t=e.n;if(t===void 0||t.t!==n)return t={i:0,S:e,p:n.s,n:void 0,t:n,e:void 0,x:void 0,r:t},n.s!==void 0&&(n.s.n=t),n.s=t,e.n=t,32&n.f&&e.S(t),t;if(t.i===-1)return t.i=0,t.n!==void 0&&(t.n.p=t.p,t.p!==void 0&&(t.p.n=t.n),t.p=n.s,t.n=void 0,n.s.n=t,n.s=t),t}}function l(e){this.v=e,this.i=0,this.n=void 0,this.t=void 0}l.prototype.brand=K;l.prototype.h=function(){return!0};l.prototype.S=function(e){this.t!==e&&e.e===void 0&&(e.x=this.t,this.t!==void 0&&(this.t.e=e),this.t=e)};l.prototype.U=function(e){if(this.t!==void 0){var t=e.e,i=e.x;t!==void 0&&(t.x=i,e.e=void 0),i!==void 0&&(i.e=t,e.x=void 0),e===this.t&&(this.t=i)}};l.prototype.subscribe=function(e){var t=this;return x(function(){var i=t.value,r=n;n=void 0;try{e(i)}finally{n=r}})};l.prototype.valueOf=function(){return this.value};l.prototype.toString=function(){return this.value+""};l.prototype.toJSON=function(){return this.value};l.prototype.peek=function(){var e=n;n=void 0;try{return this.value}finally{n=e}};Object.defineProperty(l.prototype,"value",{get:function(){var e=$(this);return e!==void 0&&(e.i=this.i),this.v},set:function(e){if(e!==this.v){if(O>100)throw new Error("Cycle detected");this.v=e,this.i++,I++,y++;try{for(var t=this.t;t!==void 0;t=t.x)t.t.N()}finally{G()}}}});function d(e){return new l(e)}function P(e){for(var t=e.s;t!==void 0;t=t.n)if(t.S.i!==t.i||!t.S.h()||t.S.i!==t.i)return!0;return!1}function H(e){for(var t=e.s;t!==void 0;t=t.n){var i=t.S.n;if(i!==void 0&&(t.r=i),t.S.n=t,t.i=-1,t.n===void 0){e.s=t;break}}}function B(e){for(var t=e.s,i=void 0;t!==void 0;){var r=t.p;t.i===-1?(t.S.U(t),r!==void 0&&(r.n=t.n),t.n!==void 0&&(t.n.p=r)):i=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=r}e.s=i}function m(e){l.call(this,void 0),this.x=e,this.s=void 0,this.g=I-1,this.f=4}(m.prototype=new l).h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===I))return!0;if(this.g=I,this.f|=1,this.i>0&&!P(this))return this.f&=-2,!0;var e=n;try{H(this),n=this;var t=this.x();(16&this.f||this.v!==t||this.i===0)&&(this.v=t,this.f&=-17,this.i++)}catch(i){this.v=i,this.f|=16,this.i++}return n=e,B(this),this.f&=-2,!0};m.prototype.S=function(e){if(this.t===void 0){this.f|=36;for(var t=this.s;t!==void 0;t=t.n)t.S.S(t)}l.prototype.S.call(this,e)};m.prototype.U=function(e){if(this.t!==void 0&&(l.prototype.U.call(this,e),this.t===void 0)){this.f&=-33;for(var t=this.s;t!==void 0;t=t.n)t.S.U(t)}};m.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(var e=this.t;e!==void 0;e=e.x)e.t.N()}};Object.defineProperty(m.prototype,"value",{get:function(){if(1&this.f)throw new Error("Cycle detected");var e=$(this);if(this.h(),e!==void 0&&(e.i=this.i),16&this.f)throw this.v;return this.v}});function ee(e){return new m(e)}function W(e){var t=e.u;if(e.u=void 0,typeof t=="function"){y++;var i=n;n=void 0;try{t()}catch(r){throw e.f&=-2,e.f|=8,L(e),r}finally{n=i,G()}}}function L(e){for(var t=e.s;t!==void 0;t=t.n)t.S.U(t);e.x=void 0,e.s=void 0,W(e)}function te(e){if(n!==this)throw new Error("Out-of-order effect");B(this),n=e,this.f&=-2,8&this.f&&L(this),G()}function b(e){this.x=e,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32}b.prototype.c=function(){var e=this.S();try{if(8&this.f||this.x===void 0)return;var t=this.x();typeof t=="function"&&(this.u=t)}finally{e()}};b.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,W(this),H(this),y++;var e=n;return n=this,te.bind(this,e)};b.prototype.N=function(){2&this.f||(this.f|=2,this.o=T,T=this)};b.prototype.d=function(){this.f|=8,1&this.f||L(this)};function x(e){var t=new b(e);try{t.c()}catch(i){throw t.d(),i}return t.d.bind(t)}var D;function S(e,t){X[e]=t.bind(null,X[e]||function(){})}function N(e){D&&D(),D=e&&e.S()}function Q(e){var t=this,i=e.data,r=re(i);r.value=i;var o=F(function(){for(var s=t.__v;s=s.__;)if(s.__c){s.__c.__$f|=4;break}return t.__$u.c=function(){var a;!z(o.peek())&&((a=t.base)==null?void 0:a.nodeType)===3?t.base.data=o.peek():(t.__$f|=1,t.setState({}))},ee(function(){var a=r.value.value;return a===0?0:a===!0?"":a||""})},[]);return o.value}Q.displayName="_st";Object.defineProperties(l.prototype,{constructor:{configurable:!0,value:void 0},type:{configurable:!0,value:Q},props:{configurable:!0,get:function(){return{data:this}}},__b:{configurable:!0,value:1}});S("__b",function(e,t){if(typeof t.type=="string"){var i,r=t.props;for(var o in r)if(o!=="children"){var s=r[o];s instanceof l&&(i||(t.__np=i={}),i[o]=s,r[o]=s.peek())}}e(t)});S("__r",function(e,t){N();var i,r=t.__c;r&&(r.__$f&=-2,(i=r.__$u)===void 0&&(r.__$u=i=function(o){var s;return x(function(){s=this}),s.c=function(){r.__$f|=1,r.setState({})},s}())),N(i),e(t)});S("__e",function(e,t,i,r){N(),e(t,i,r)});S("diffed",function(e,t){N();var i;if(typeof t.type=="string"&&(i=t.__e)){var r=t.__np,o=t.props;if(r){var s=i.U;if(s)for(var a in s){var f=s[a];f!==void 0&&!(a in r)&&(f.d(),s[a]=void 0)}else i.U=s={};for(var u in r){var v=s[u],p=r[u];v===void 0?(v=ie(i,u,p,o),s[u]=v):v.o(p,o)}}}e(t)});function ie(e,t,i,r){var o=t in e&&e.ownerSVGElement===void 0,s=d(i);return{o:function(a,f){s.value=a,r=f},d:x(function(){var a=s.value.value;r[t]!==a&&(r[t]=a,o?e[t]=a:a?e.setAttribute(t,a):e.removeAttribute(t))})}}S("unmount",function(e,t){if(typeof t.type=="string"){var i=t.__e;if(i){var r=i.U;if(r){i.U=void 0;for(var o in r){var s=r[o];s&&s.d()}}}}else{var a=t.__c;if(a){var f=a.__$u;f&&(a.__$u=void 0,f.d())}}e(t)});S("__h",function(e,t,i,r){(r<3||r===9)&&(t.__$f|=2),e(t,i,r)});Z.prototype.shouldComponentUpdate=function(e,t){var i=this.__$u;if(!(i&&i.s!==void 0||4&this.__$f)||3&this.__$f)return!0;for(var r in t)return!0;for(var o in e)if(o!=="__source"&&e[o]!==this.props[o])return!0;for(var s in this.props)if(!(s in e))return!0;return!1};function re(e){return F(function(){return d(e)},[])}const se=d({checked:!0,setByUser:!1}),_=d({pending:!1,data:void 0});x(()=>{var e;(e=_.value.data)!=null&&e.isVirtual&&(se.value={checked:!1,setByUser:!1})});x(()=>{_.value.pending||(A.emit("checkout/data",_.value.data||null),_.value.data&&A.emit("cart/updated",_.value.data.id))});const oe=d({data:void 0,pending:!1}),ne=d({pending:!1,data:void 0}),ae=d({pending:!1,data:void 0}),le=d({pending:!1,data:void 0}),ue=d({data:void 0,pending:!1}),M=[];function fe(e){return new Promise((t,i)=>{M.push(e);const r=()=>{M[0]===e?e().then(t).catch(i).finally(()=>M.shift()):setTimeout(r,100)};r()})}const ce=["sender_email","recipient_email"];function de(e){return e.filter(t=>!t.path||!ce.some(i=>{var r;return((r=t.path)==null?void 0:r.at(-1))===i}))}const he={cart:_,customer:ne,estimateShippingMethods:ae,regions:le,storeConfig:ue,countryList:oe};function ve(e,t){return t.split(".").reduce((i,r)=>i&&i[r]!==void 0?i[r]:void 0,e)}const k={cart:null,customer:null,estimateShippingMethods:null,regions:null,storeConfig:null,countryList:null};async function pe(e){const{defaultValueOnFail:t,query:i,options:r,path:o,signalType:s,type:a,transformer:f}=e,u=he[s],v=Symbol();k[s]=v,u.value={...u.value,pending:!0};try{const{data:p,errors:R}=await(a==="mutation"?fe(()=>w(i,r).catch(U)):w(i,{method:"GET",cache:"no-cache",...r}).catch(U));if(R){const q=de(R);if(q.length>0)throw new J(q)}let E=ve(p,o);if(E===void 0)throw new Error(`No data found at path: ${o}`);return f&&(E=f(E)),u.value={...u.value,data:E},setTimeout(()=>{u.value={...u.value,pending:k[s]===v?!1:u.value.pending}},0),E}catch(p){if(t)return u.value={pending:!1,data:t},t;if(p.name==="AbortError")return;throw u.value={...u.value,pending:!1},p}}const _e={cartId:null,authenticated:!1},ke=new Proxy(_e,{set(e,t,i){return e[t]=i,!0},get(e,t){return e[t]}}),ge=e=>e?e.filter(Boolean).filter(i=>(i==null?void 0:i.label)&&(i==null?void 0:i.value)).map(i=>({text:i.label,value:i.value})):[],ye=e=>e?e.filter(Boolean).filter(t=>(t==null?void 0:t.name)&&(t==null?void 0:t.value)):[],me=e=>e?e.filter(Boolean).map(i=>({code:i.code,defaultValue:i.default_value||void 0,frontendInput:i.frontend_input||void 0,isDisabled:!1,isRequired:i.is_required,label:i.label||void 0,multilineCount:i.multiline_count||void 0,options:ge(i.options),sortOrder:i.sort_order||void 0,validateRules:ye(i.validate_rules)})):[],Se=e=>e==null,Ee=(e,t)=>e.amount.value-t.amount.value,j=e=>!(!e||!e.method_code||!e.method_title||Se(e.amount.value)||!e.amount.currency),V=e=>({amount:{value:e.amount.value,currency:e.amount.currency},title:e.method_title,code:e.method_code,carrier:{code:e.carrier_code,title:e.carrier_title},value:`${e.carrier_code} - ${e.method_code}`,...e.price_excl_tax&&{amountExclTax:{value:e.price_excl_tax.value,currency:e.price_excl_tax.currency}},...e.price_incl_tax&&{amountInclTax:{value:e.price_incl_tax.value,currency:e.price_incl_tax.currency}}}),Fe=e=>{if(j(e))return V(e)},$e=e=>{if(e)return e.filter(j).map(t=>V(t)).sort(Ee)},Te=`
  query getStoreConfig {
    storeConfig {
      countries_with_required_region
      default_country
      display_state_if_optional
      is_guest_checkout_enabled
      is_one_page_checkout_enabled
      locale
      optional_zip_countries
      shopping_cart_display_shipping
      store_code
    }
  }
`;var g=(e=>(e.EXCLUDING_TAX="EXCLUDING_TAX",e.INCLUDING_EXCLUDING_TAX="INCLUDING_AND_EXCLUDING_TAX",e.INCLUDING_TAX="INCLUDING_TAX",e))(g||{});const Ce="US",h={defaultCountry:Ce,countriesWithRequiredRegion:[],displayStateIfOptional:!1,countriesWithOptionalZipCode:[],isGuestCheckoutEnabled:!1,isOnePageCheckoutEnabled:!1,shoppingCartDisplaySetting:{shipping:g.EXCLUDING_TAX}},Pe=async()=>await pe({type:"query",query:Te,options:{method:"GET",cache:"no-cache"},path:"storeConfig",signalType:"storeConfig",transformer:xe,defaultValueOnFail:h});function be(e){switch(e){case 1:return g.EXCLUDING_TAX;case 2:return g.INCLUDING_TAX;case 3:return g.INCLUDING_EXCLUDING_TAX;default:return g.EXCLUDING_TAX}}function xe(e){if(!e)return h;const{default_country:t,countries_with_required_region:i,display_state_if_optional:r,optional_zip_countries:o,is_guest_checkout_enabled:s,is_one_page_checkout_enabled:a,shopping_cart_display_shipping:f}=e;return{defaultCountry:t||h.defaultCountry,countriesWithRequiredRegion:(i==null?void 0:i.split(","))||h.countriesWithRequiredRegion,displayStateIfOptional:r||h.displayStateIfOptional,countriesWithOptionalZipCode:(o==null?void 0:o.split(","))||h.countriesWithOptionalZipCode,isGuestCheckoutEnabled:s||h.isGuestCheckoutEnabled,isOnePageCheckoutEnabled:a||h.isOnePageCheckoutEnabled,shoppingCartDisplaySetting:{shipping:be(f)}}}const{setEndpoint:He,setFetchGraphQlHeader:Be,removeFetchGraphQlHeader:We,setFetchGraphQlHeaders:Qe,fetchGraphQl:w,getConfig:je}=new Y().getMethods(),Ie=`
  query fetchAddressFormFields {
    attributesForm(formCode: "customer_register_address") {
      items {
        frontend_input
        code
        label
        default_value
        is_required
        options {
          label
          value
          is_default
        }
        ... on CustomerAttributeMetadata {
          multiline_count
          sort_order
          validate_rules {
            name
            value
          }
        }
      }
      errors {
        message
        type
      }
    }
  }
`,Ne=e=>{if(!(!e||e.length===0))throw Error(e.map(t=>t.message).join(" "))},Ve=async()=>w(Ie,{method:"GET",cache:"no-cache"}).then(({data:e,errors:t})=>(Ne(t),me(e.attributesForm.items))).catch(U);var c=(e=>(e.Boolean="BOOLEAN",e.Date="DATE",e.Datetime="DATETIME",e.File="FILE",e.Gallery="GALLERY",e.Hidden="HIDDEN",e.Image="IMAGE",e.MediaImage="MEDIA_IMAGE",e.Multiline="MULTILINE",e.Multiselect="MULTISELECT",e.Price="PRICE",e.Select="SELECT",e.Text="TEXT",e.Textarea="TEXTAREA",e.Undefined="UNDEFINED",e.Weight="WEIGHT",e))(c||{}),De=(e=>(e.DateRangeMax="DATE_RANGE_MAX",e.DateRangeMin="DATE_RANGE_MIN",e.FileExtensions="FILE_EXTENSIONS",e.InputValidation="INPUT_VALIDATION",e.MaxFileSize="MAX_FILE_SIZE",e.MaxImageHeight="MAX_IMAGE_HEIGHT",e.MaxImageWidth="MAX_IMAGE_WIDTH",e.MaxTextLength="MAX_TEXT_LENGTH",e.MinTextLength="MIN_TEXT_LENGTH",e))(De||{});const Ze=[{frontendInput:c.Text,code:"firstname",label:"First Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:10},{frontendInput:c.Text,code:"lastname",label:"Last Name",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:20},{frontendInput:c.Text,code:"company",label:"Company",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:30},{frontendInput:c.Multiline,code:"street",label:"Street Address",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:40},{frontendInput:c.Text,code:"city",label:"City",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:50},{frontendInput:c.Select,code:"country_id",label:"Country",isRequired:!0,isDisabled:!1,options:[{text:"United States",value:"US"},{text:"Spain",value:"ES"},{text:"France",value:"FR"}],validateRules:[],sortOrder:60},{frontendInput:c.Text,code:"region",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:70},{frontendInput:c.Hidden,code:"region_id",label:"State/Province",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:80},{frontendInput:c.Text,code:"postcode",label:"Zip/Postal Code",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:90},{frontendInput:c.Text,code:"telephone",label:"Phone Number",isRequired:!0,isDisabled:!1,options:[],validateRules:[],sortOrder:100},{frontendInput:c.Text,code:"vat_id",label:"VAT Number",isRequired:!1,isDisabled:!1,options:[],validateRules:[],sortOrder:110}];export{c as A,oe as B,Ce as D,J as F,C as I,Ge as M,h as S,g as T,we as U,De as V,Le as a,Re as b,qe as c,Xe as d,Be as e,Qe as f,w as g,je as h,Ve as i,Ze as j,Pe as k,se as l,ne as m,_ as n,ke as o,pe as p,ue as q,We as r,He as s,$e as t,Fe as u,U as v,Ne as w,d as x,ae as y,le as z};
