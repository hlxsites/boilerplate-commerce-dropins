import"@dropins/tools/event-bus.js";import{n as T,m as B}from"./fixtures.js";import{i as z,s as V}from"./setGuestEmailOnCart.js";import{H as $,p as j}from"./ToggleButton.js";import{useState as f,useEffect as q}from"@dropins/tools/preact-hooks.js";import{classes as N}from"@dropins/tools/lib.js";import{Field as G,Input as O,Divider as P}from"@dropins/tools/components.js";/* empty css                     */import{jsx as i,jsxs as c,Fragment as w}from"@dropins/tools/preact-jsx-runtime.js";import{useText as k,Text as F}from"@dropins/tools/i18n.js";import{L as R}from"./constants3.js";const U=({value:o,error:l,hint:t,onChange:u,onBlur:d,onInvalid:n})=>{const e=k({LoginFormLabel:"Checkout.LoginForm.ariaLabel",LoginFormFloatingLabel:"Checkout.LoginForm.floatingLabel",LoginFormPlaceholder:"Checkout.LoginForm.placeholder"});return i(G,{size:"medium",error:l,hint:t,children:i(O,{id:"customer-email",name:"customer-email",type:"email",value:o,autocomplete:"email",placeholder:e.LoginFormPlaceholder,floatingLabel:e.LoginFormFloatingLabel,onChange:u,onBlur:d,onInvalid:n,required:!0,"aria-label":e.LoginFormLabel,"aria-required":!0})})},J=({onSignInClick:o,email:l})=>c("div",{className:"checkout-login-form__sign-in",children:[i(F,{id:"Checkout.LoginForm.account"}),i("a",{"data-testid":"sign-in-link",className:"checkout-login-form__link",href:"#",target:"_blank",rel:"noreferrer",onClick:t=>{t.preventDefault(),o==null||o(l)},children:i(F,{id:"Checkout.LoginForm.signIn"})})]}),K=({name:o,className:l,currentEmail:t,hint:u,error:d=null,onEmailChange:n,onEmailBlur:e,onEmailInvalid:L,onSignInClick:v,onSignOutClick:p,customer:a,...s})=>{const h=k({Title:"Checkout.LoginForm.title"}),g=!!a;return c("div",{...s,className:N(["checkout-login-form",l]),"data-testid":"checkout-login-form",children:[c("div",{className:"checkout-login-form__heading",children:[i($,{level:2,className:"checkout-login-form__title",children:h.Title}),g?i(Q,{onSignOutClick:p}):i(J,{onSignInClick:v,email:t})]}),a?c("div",{className:"checkout-login-form__customer-details",children:[i("div",{className:"checkout-login-form__customer-name",children:`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`}),i("div",{className:"checkout-login-form__customer-email",children:a==null?void 0:a.email})]}):i("div",{className:"checkout-login-form__content",children:c("form",{className:N(["dropin-login-form__form",l]),name:o,noValidate:!0,children:[i("button",{type:"submit",disabled:!0,style:"display: none","aria-hidden":"true"}),i(U,{value:t||void 0,error:d||"",hint:u,onChange:n,onBlur:e,onInvalid:L})]})}),i(P,{variant:"primary"})]})},Q=({onSignOutClick:o})=>c("p",{className:"checkout-login-form__sign-out",children:[i(F,{id:"Checkout.LoginForm.switch"}),i("a",{className:"checkout-login-form__link",href:"#",target:"_blank",rel:"noreferrer",onClick:l=>{l.preventDefault(),o==null||o()},children:i(F,{id:"Checkout.LoginForm.signOut"})})]}),W=o=>j.email.test(o),X=1e3,se=({className:o,email:l=null,onSignInClick:t,onSignOutClick:u,...d})=>{const n=k({LoginFormInvalidEmailError:"Checkout.LoginForm.invalidEmailError",LoginFormMissingEmailError:"Checkout.LoginForm.missingEmailError",LoginFormEmailExistsAlreadyHaveAccount:"Checkout.LoginForm.emailExists.alreadyHaveAccount",LoginFormEmailExistsSignInButton:"Checkout.LoginForm.emailExists.signInButton",LoginFormEmailExistsForFasterCheckout:"Checkout.LoginForm.emailExists.forFasterCheckout"}),{data:e}=T.value,L=(e==null?void 0:e.id)||"",v=!!e,[p,a]=f(!1),[s,h]=f(l),[g,E]=f(),[x,_]=f(!0),b=r=>r.valid?null:r.valueMissing?n.LoginFormMissingEmailError:n.LoginFormInvalidEmailError,C=B.value.data,y=r=>{const{value:m}=r.target;h(m),E(null),_(!0)},A=r=>{const{validity:m}=r.target;E(b(m))},I=r=>{const{validity:m}=r.target;E(b(m))};!p&&v&&(a(!0),h((e==null?void 0:e.email)||l)),q(()=>{if(!s||g)return;const r=setTimeout(()=>{z(s).then(m=>{_(m),(e==null?void 0:e.email)!==s&&V(s).catch(M=>{console.log("set email failed",M)})}).catch(m=>{console.log(m),E(n.LoginFormInvalidEmailError),_(!0)})},X);return()=>{r&&clearTimeout(r)}},[s,g,n.LoginFormInvalidEmailError,e==null?void 0:e.email,L]);const H=x?"":c(w,{children:[n.LoginFormEmailExistsAlreadyHaveAccount," ",i("a",{href:"#",onClick:r=>{r.preventDefault(),t==null||t(s)},children:n.LoginFormEmailExistsSignInButton})," ",n.LoginFormEmailExistsForFasterCheckout]});return i(K,{className:o,currentEmail:s,error:g,hint:H,name:R,onEmailBlur:A,onEmailChange:y,onEmailInvalid:I,onSignInClick:r=>{const m=s?W(s):!1;t==null||t(m?r:null)},onSignOutClick:u,customer:C,...d})};export{se as L};
