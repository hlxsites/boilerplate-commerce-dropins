import{jsx as l}from"@dropins/tools/preact-jsx-runtime.js";import"@dropins/tools/event-bus.js";import{n as g,v as h,w as k}from"./getCart.graphql.js";import{s as S}from"./setBillingAddress.js";import{classes as b}from"@dropins/tools/lib.js";import{Checkbox as v,Skeleton as C,SkeletonRow as _}from"@dropins/tools/components.js";import{useText as y}from"@dropins/tools/i18n.js";import{useState as A,useEffect as f}from"@dropins/tools/preact-compat.js";function B(t){return t.displayName||t.name||"Component"}const I=({className:t,isInitialized:s=!0,checked:n=!0,...i})=>{const e=y({title:"Checkout.BillToShippingAddress.title"});return s?l("div",{className:b(["checkout-bill-to-shipping-address",t]),children:l(v,{"data-testid":"bill-to-shipping-checkbox",className:"checkout-bill-to-shipping-address__checkbox",checked:n,name:"checkout-bill-to-shipping-address__checkbox",label:e.title,...i})}):l(N,{})},N=()=>l(C,{className:"bill-to-shipping-address__skeleton",children:l(_,{variant:"row",size:"small"})}),m="is_bill_to_shipping_address",x=t=>{const s=B(t),n=({hideOnEmptyCart:i=!0,hideOnVirtualCart:e=!1,...c})=>{const r=g.value.data,a=r!==void 0&&(r===null||r.isEmpty),o=!!(r!=null&&r.isVirtual);return i&&a||e&&o?null:l(t,{...c})};return n.displayName=`Conditional(${s})`,n};function T(t,s,n){const i=t[n],e=s[n];return i===void 0&&e===void 0||i===null&&e===null?!0:typeof i=="object"&&typeof e=="object"?JSON.stringify(i)===JSON.stringify(e):i===e}function w(t,s,n){return!s&&!n?!0:!s||!n?!1:t.every(i=>{const e=i.code;return T(s,n,e)})}const z=({isBillToShipping:t})=>{var u;const[s,n]=A(!1),i=k.value.data,e=g.value.data,c=(e==null?void 0:e.id)||"",r=!!e,a=e==null?void 0:e.billingAddress,o=(u=e==null?void 0:e.shippingAddresses)==null?void 0:u[0],d=!!o;return f(()=>{if(s)return;const p=localStorage.getItem(m);p&&(n(!0),t.value={checked:p==="true",setByUser:!1})},[s,t]),f(()=>{if(s||!i||!r)return;n(!0);const p=w(i,a,o);t.value={checked:a?p:t.value.checked,setByUser:!1}},[a,i,r,t,s,o]),{cartId:c,isInitialized:s,hasShippingAddress:d}},E=({children:t,...s})=>{const n=h.value.checked,{hasShippingAddress:i,isInitialized:e}=z({isBillToShipping:h});return l("div",{children:l(I,{...s,checked:n,isInitialized:e,onChange:r=>{const o=r.target.checked;if(h.value={checked:o,setByUser:!0},localStorage.setItem(m,o.toString()),!e||!o||!i)return;const d=new AbortController;return S({signal:d.signal,input:{same_as_shipping:!0}}).catch(u=>{console.error(u)}),()=>{d.abort()}},disabled:g.value.pending})})},P=x(E);export{P as B,m as a,w as c,x as w};
