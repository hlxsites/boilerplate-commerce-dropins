import"../chunks/ToggleButton.js";import{events as S}from"@dropins/tools/event-bus.js";import{useState as L,useEffect as E}from"@dropins/tools/preact-hooks.js";import{q as M,T as k}from"../chunks/fixtures.js";import{VComponent as w,classes as C}from"@dropins/tools/lib.js";import{Skeleton as A,SkeletonRow as B,Price as h}from"@dropins/tools/components.js";/* empty css                             */import{jsx as t,jsxs as I}from"@dropins/tools/preact-jsx-runtime.js";import{useText as G,Text as o}from"@dropins/tools/i18n.js";import"../chunks/getMultilineValues.js";import"@dropins/tools/preact-compat.js";import"../chunks/address-form-fields.js";import"@dropins/tools/preact.js";import"../chunks/ErrorBanner.js";import"../chunks/MergedCartBanner.js";import"@dropins/tools/fetch-graphql.js";const P=()=>t(A,{"data-testid":"estimate-shipping-skeleton",children:t(B,{size:"small"})}),Z=()=>{const[e,s]=L(),c=e!==void 0,r=(e==null?void 0:e.amount.value)===0,{data:n,pending:_}=M.value,y=_||n===void 0,l=n==null?void 0:n.shoppingCartDisplaySetting.shipping,D=l===k.INCLUDING_EXCLUDING_TAX,g=l===k.INCLUDING_TAX,x=G({freeShipping:"Checkout.EstimateShipping.freeShipping",taxToBeDetermined:"Checkout.EstimateShipping.taxToBeDetermined"});if(E(()=>{const i=S.on("shipping/estimate",a=>{const p=a.shippingMethod,{amount:m,amountExclTax:u,amountInclTax:d}=p;s({estimated:!0,amount:m,amountExclTax:u,amountInclTax:d})});return()=>{i==null||i.off()}},[]),E(()=>{const i=S.on("checkout/data",a=>{var f,T;const p=(T=(f=a==null?void 0:a.shippingAddresses)==null?void 0:f[0])==null?void 0:T.selectedShippingMethod;if(!p)return;const{amount:m,amountExclTax:u,amountInclTax:d}=p;s({estimated:!1,amount:m,amountExclTax:u,amountInclTax:d})});return()=>{i==null||i.off()}},[]),!c||y)return t(P,{});const N=()=>r?t("span",{"data-testId":"free-shipping",children:x.freeShipping}):g&&e.amountInclTax?t(h,{"data-testid":"shipping",amount:e.amountInclTax.value,currency:e.amountInclTax.currency}):t(h,{"data-testid":"shipping",amount:e.amount.value,currency:e.amount.currency}),v=()=>e.amountExclTax?t(h,{"data-testid":"shipping-excluding-tax",amount:e.amountExclTax.value,currency:e.amountExclTax.currency}):t("span",{children:x.taxToBeDetermined});return t(U,{estimated:e.estimated,price:N(),taxExcluded:D,taxIncluded:g,priceExclTax:v()})},U=({estimated:e=!1,price:s,priceExclTax:c,taxExcluded:r=!1,taxIncluded:n=!1})=>I("div",{"data-testid":"estimate-shipping",className:"checkout-estimate-shipping",children:[t("span",{className:"checkout-estimate-shipping__label",children:e?t(o,{id:"Checkout.EstimateShipping.estimated"}):t(o,{id:"Checkout.EstimateShipping.label"})}),t(w,{node:s,className:"checkout-estimate-shipping__price"}),n&&t("span",{"data-testid":"shipping-tax-included",className:C(["checkout-estimate-shipping__caption"]),children:t(o,{id:"Checkout.EstimateShipping.withTaxes"})}),r&&I("span",{"data-testid":"shipping-tax-included-excluded",className:C(["checkout-estimate-shipping__caption"]),children:[c,t(o,{id:"Checkout.EstimateShipping.withoutTaxes"})]})]});export{Z as EstimateShipping,Z as default};
