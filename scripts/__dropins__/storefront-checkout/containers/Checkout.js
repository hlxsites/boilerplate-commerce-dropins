import{jsx as r,jsxs as j}from"@dropins/tools/preact-jsx-runtime.js";import{k as K,n as $,o as f,U as w}from"../chunks/getCart.graphql.js";import"@dropins/tools/event-bus.js";import{a as H}from"../chunks/getCustomer.js";import{p as q}from"../chunks/placeOrder.js";import{C as k,B as z,L as G,c as J,P as Q,a as R,S as W}from"../chunks/ShippingMethods.js";import"@dropins/tools/preact-hooks.js";import{Slot as p,classes as a}from"@dropins/tools/lib.js";import{IllustratedMessage as X,Icon as Y,Button as Z}from"@dropins/tools/components.js";import{B as D}from"../chunks/BillToShippingAddress.js";import{O as rr,S as er}from"../chunks/OutOfStock.js";import{useText as C}from"@dropins/tools/i18n.js";import{useState as u,useCallback as or}from"@dropins/tools/preact-compat.js";import{E as tr}from"../chunks/EmptyCart.js";import"@dropins/tools/signals.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/setShippingMethods.js";import"../chunks/setBillingAddress.js";import"../chunks/ErrorBanner.js";import"../chunks/MergedCartBanner.js";const Pr="OUT_OF_STOCK",br=({className:c,slots:e,routeHome:n,onCartProductsUpdate:m,onCheckoutDataUpdate:s,preselectedCartData:o,onSignInClick:O,onSignOutClick:d,...y})=>{const E=K.authenticated,[M,_]=u(!1),[h,l]=u(""),P=h!=="",[b,T]=u(),{data:t,pending:g}=$.value,{data:S,pending:x}=f.value,B=g&&E&&!S,F=!!(t!=null&&t.isVirtual),L=t&&!(t!=null&&t.isEmpty)&&!g&&!F,A=C({CheckoutUnexpectedError:"Checkout.ServerError.unexpected"}),U=or(async()=>{t&&(await q(),_(!0))},[t]),V=i=>{T(i?()=>i:void 0)},I=async()=>{l(""),t&&H()},v=i=>{const N=i instanceof TypeError||i instanceof w?A.CheckoutUnexpectedError:i.message;l(N)};return M?null:P?r(ir,{errorMessage:h,onClick:I}):r(k,{className:c,isLoading:B||x,...y,children:r(k.Main,{blocks:{cartSummaryList:r(p,{name:"CartSummaryList",slot:e==null?void 0:e.CartSummaryList}),orderSummary:r(p,{name:"OrderSummary",slot:e==null?void 0:e.OrderSummary}),outOfStock:r(rr,{routeCart:n,onCartProductsUpdate:m}),emptyCart:r(tr,{routeHome:n}),billingAddress:r(z,{}),billToShippingAddress:r(D,{hideOnVirtualCart:!0},`bill-to-shipping-address${S?"-customer":""}`),login:r(G,{onSignInClick:O,onSignOutClick:()=>{d==null||d(),f.value.pending=!0}}),paymentMethods:r(J,{onPlaceOrder:V,handleServerError:v,paymentMethodsSlot:e==null?void 0:e.PaymentMethods}),placeOrder:r(Q,{onClick:b??U,handleServerError:v}),shippingAddress:r(R,{hideOnVirtualCart:!0,onCheckoutDataUpdate:s,preselectedFields:o==null?void 0:o.address}),shippingMethods:L?r(p,{name:"ShippingMethods",slot:e==null?void 0:e.ShippingMethods,children:r(W,{name:"shipping-methods",hideOnVirtualCart:!0,onCheckoutDataUpdate:s,preSelectedMethod:o==null?void 0:o.shippingMethod})}):void 0}})})},ir=({className:c,errorMessage:e,contactSupport:n,...m})=>{const{onClick:s}=m,o=C({Title:"Checkout.ServerError.title",Message:"Checkout.ServerError.message",ContactSupport:"Checkout.ServerError.contactSupport",Button:"Checkout.ServerError.button"});return r(X,{"aria-invalid":"true","aria-describedby":"checkout-server-error__message","aria-live":"polite",className:a(["checkout-server-error",c]),"data-testid":"checkout-server-error",heading:e??o.Title,message:j("p",{id:a(["checkout-server-error__message"]),children:[o.Message,r("br",{}),r("span",{children:n??o.ContactSupport})]}),icon:r(Y,{className:a(["checkout-server-error__icon"]),source:er}),action:r(Z,{className:a(["checkout-server-error__button"]),onClick:s,children:o.Button})})};export{br as Checkout,Pr as OUT_OF_STOCK,br as default};
