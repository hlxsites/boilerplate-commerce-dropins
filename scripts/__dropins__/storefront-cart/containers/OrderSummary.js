import{jsxs as l,jsx as a,Fragment as M}from"@dropins/tools/preact-jsx-runtime.js";import*as j from"@dropins/tools/preact-compat.js";import{useState as Z,useEffect as J}from"@dropins/tools/preact-compat.js";import{classes as s,VComponent as h,Slot as rr}from"@dropins/tools/lib.js";import{events as K}from"@dropins/tools/event-bus.js";import{s as er,i as tr}from"../chunks/resetCart.js";import{g as ar}from"../chunks/getEstimatedTotals.js";import{Accordion as ir,AccordionSection as cr,ProgressSpinner as nr,Divider as ur,Price as o,Button as mr}from"@dropins/tools/components.js";/* empty css                    */import{useText as Y}from"@dropins/tools/i18n.js";import"@dropins/tools/fetch-graphql.js";import"../chunks/CartFragment.js";const sr=()=>{const[g,f]=Z(!1),[S,x]=Z();return{handleEstimateTotals:(r,d)=>{f(!0);const{shippingCountry:b,shippingState:e="",shippingZip:C=""}=r,p={countryCode:b,postcode:C,region:{region:e},shipping_method:{carrier_code:(d==null?void 0:d.carrier_code)||"",method_code:(d==null?void 0:d.method_code)||""}};ar(p).then(t=>{var _,B,v,u,P,N,w,I,k,E,L,m,O,W,G,z,F,c,i,D;t&&x({estimatedTaxTotal:{amount:(_=t.totalTax)==null?void 0:_.value,currency:(B=t.totalTax)==null?void 0:B.currency},estimatedSubTotal:{excludingTax:{amount:(u=(v=t.subtotal)==null?void 0:v.excludingTax)==null?void 0:u.value,currency:(N=(P=t.subtotal)==null?void 0:P.excludingTax)==null?void 0:N.currency},includingTax:{amount:(I=(w=t.subtotal)==null?void 0:w.includingTax)==null?void 0:I.value,currency:(E=(k=t.subtotal)==null?void 0:k.includingTax)==null?void 0:E.currency},includingDiscountOnly:{amount:(m=(L=t.subtotal)==null?void 0:L.includingDiscountOnly)==null?void 0:m.value,currency:(W=(O=t.subtotal)==null?void 0:O.includingDiscountOnly)==null?void 0:W.currency}},estimatedGrandTotalPrice:{includingTax:{amount:(G=t.total)==null?void 0:G.includingTax.value,currency:(z=t.total)==null?void 0:z.includingTax.currency},excludingTax:{amount:(F=t.total)==null?void 0:F.excludingTax.value,currency:(c=t.total)==null?void 0:c.excludingTax.currency}},estimatedAppliedTaxes:{taxes:(i=t.appliedTaxes)==null?void 0:i.map(n=>{var y,T;return{label:n.label,amount:{value:(y=n.amount)==null?void 0:y.value,currency:(T=n.amount)==null?void 0:T.currency}}})},estimatedItems:{items:(D=t.items)==null?void 0:D.map(n=>{var y,T,U,V,X,q,$,Q,R,H;return{uid:n.uid,price:{amount:(y=n.price)==null?void 0:y.value,currency:(T=n.price)==null?void 0:T.currency},taxedPrice:{amount:(U=n.taxedPrice)==null?void 0:U.value,currency:(V=n.taxedPrice)==null?void 0:V.currency},rowTotal:{amount:(X=n.rowTotal)==null?void 0:X.value,currency:(q=n.rowTotal)==null?void 0:q.currency},rowTotalIncludingTax:{amount:($=n.rowTotalIncludingTax)==null?void 0:$.value,currency:(Q=n.rowTotalIncludingTax)==null?void 0:Q.currency},regularPrice:{amount:(R=n.regularPrice)==null?void 0:R.value,currency:(H=n.regularPrice)==null?void 0:H.currency}}})}})}).finally(()=>{f(!1)})},estimatedTotals:S,setEstimatedTotals:x,loading:g}},or=g=>j.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...g},j.createElement("path",{d:"M7.74512 9.87701L12.0001 14.132L16.2551 9.87701",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),lr=g=>j.createElement("svg",{width:24,height:24,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...g},j.createElement("path",{d:"M7.74512 14.132L12.0001 9.87701L16.2551 14.132",stroke:"#2B2B2B",strokeWidth:1.5,strokeLinecap:"square",strokeLinejoin:"round"})),dr=({className:g,children:f,variant:S="primary",heading:x,loading:A=!0,subTotal:r,shipping:d,discounts:b,taxTotal:e,taxesApplied:C,total:p,primaryAction:t,..._})=>{const[B,v]=Z(!1),u=Y({checkout:"Cart.PriceSummary.checkout",discountedPrice:"Cart.CartItem.discountedPrice",download:"Cart.CartItem.download",heading:"Cart.Cart.heading",message:"Cart.CartItem.message",regularPrice:"Cart.CartItem.regularPrice",recipient:"Cart.CartItem.recipient",sender:"Cart.CartItem.sender",file:"Cart.CartItem.file",files:"Cart.CartItem.files",orderSummary:"Cart.PriceSummary.orderSummary",taxesBreakdownTitle:"Cart.PriceSummary.taxes.breakdown",taxTotal:"Cart.PriceSummary.taxes.total",taxEstimated:"Cart.PriceSummary.taxes.estimated",taxTotalOnly:"Cart.PriceSummary.taxes.totalOnly",showTaxBreakdown:"Cart.PriceSummary.taxes.showBreakdown",hideTaxBreakdown:"Cart.PriceSummary.taxes.hideBreakdown",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined",subtotalLabel:"Cart.PriceSummary.subTotal.label",subtotalWithTaxes:"Cart.PriceSummary.subTotal.withTaxes",subtotalWithoutTaxes:"Cart.PriceSummary.subTotal.withoutTaxes",totalEstimated:"Cart.PriceSummary.total.estimated",totalLabel:"Cart.PriceSummary.total.label",totalWithoutTax:"Cart.PriceSummary.total.withoutTax",shippingLabel:"Cart.PriceSummary.shipping.label",zipPlaceholder:"Cart.PriceSummary.shipping.zipPlaceholder",editZipAction:"Cart.PriceSummary.shipping.editZipAction",shippingWithTaxes:"Cart.PriceSummary.shipping.withTaxes",shippingWithoutTaxes:"Cart.PriceSummary.shipping.withoutTaxes",shippingEstimated:"Cart.PriceSummary.shipping.estimated",shippingEstimatedByState:"Cart.PriceSummary.shipping.alternateField.state",shippingEstimatedByZip:"Cart.PriceSummary.shipping.alternateField.zip",destinationLinkAriaLabel:"Cart.PriceSummary.shipping.destinationLinkAriaLabel",applyButton:"Cart.PriceSummary.estimatedShippingForm.apply.label",countryField:"Cart.PriceSummary.estimatedShippingForm.country.placeholder",freeShipping:"Cart.PriceSummary.freeShipping",stateField:"Cart.PriceSummary.estimatedShippingForm.state.placeholder",zipField:"Cart.PriceSummary.estimatedShippingForm.zip.placeholder"}),P=r&&l("div",{className:s(["cart-order-summary__entry","cart-order-summary__subTotal"]),children:[a("span",{className:"cart-order-summary__label",children:u.subtotalLabel}),a(h,{node:r.price,className:"cart-order-summary__price"}),r.taxIncluded&&a("div",{"data-testid":"sub-total-tax-caption",className:"cart-order-summary__caption",children:a("span",{children:u.subtotalWithTaxes})}),r.taxExcluded?a("div",{"data-testid":"sub-total-tax-caption-excluded",className:"cart-order-summary__caption",children:l("span",{children:[r.priceExcludingTax,"Â ",u.subtotalWithoutTaxes]})}):void 0]}),N=d&&a(h,{node:d,className:"cart-order-summary__shipping"}),w=b&&b.length>0&&a(M,{children:b.map(m=>l("div",{className:s(["cart-order-summary__entry","cart-order-summary__discount"]),children:[a("span",{className:"cart-order-summary__label",children:m.label}),a(h,{node:m.price,className:"cart-order-summary__price"}),m.caption&&a(h,{node:m.caption,className:"cart-order-summary__caption"})]},m.label))}),I=C&&C.length>0?a(ir,{"data-testid":"tax-breakdown",className:"cart-order-summary__taxes",iconOpen:or,iconClose:lr,children:l(cr,{title:u.taxesBreakdownTitle,secondaryText:!B&&e?a(h,{node:e.price,className:"cart-order-summary__price"}):void 0,renderContentWhenClosed:!1,onStateChange:v,children:[a("div",{className:"cart-order-summary__appliedTaxes",children:C.map(m=>l("div",{className:s(["cart-order-summary__entry","cart-order-summary__taxEntry"]),children:[a("span",{className:s(["cart-order-summary__label","cart-order-summary__label--muted"]),children:m.label}),a(h,{node:m.price,className:s(["cart-order-summary__price","cart-order-summary__price--muted"])})]},m.label))}),l("div",{className:s(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[a("span",{className:"cart-order-summary__label",children:u.taxTotal}),e&&a(h,{node:e.price,className:"cart-order-summary__price"})]})]})}):e&&l("div",{"data-testid":"tax-total-only",className:s(["cart-order-summary__entry","cart-order-summary__taxTotal"]),children:[a("span",{className:"cart-order-summary__label",children:e.estimated?u.taxEstimated:u.taxTotalOnly}),a(h,{node:e.price,className:"cart-order-summary__price"})]}),k=p&&l("div",{"data-testid":"total-content",className:s(["cart-order-summary__entry","cart-order-summary__total",p.estimated&&"cart-order-summary__total--padded"]),children:[a("span",{className:s(["cart-order-summary__label","cart-order-summary__label--bold"]),children:p.estimated?u.totalEstimated:u.totalLabel}),a(h,{node:p.price,className:s(["cart-order-summary__price","cart-order-summary__price--bold"])})]}),E=p&&p.priceWithoutTax&&l("div",{"data-testid":"total-without-tax",className:s(["cart-order-summary__entry","cart-order-summary__totalWithoutTax"]),children:[a("span",{className:s(["cart-order-summary__label","cart-order-summary__label--muted"]),children:u.totalWithoutTax}),a(h,{node:p.priceWithoutTax,className:s(["cart-order-summary__price","cart-order-summary__price--muted"])})]}),L=t&&a("div",{className:s(["cart-order-summary__entry","cart-order-summary__primaryAction"]),children:t});return l("div",{..._,className:s(["cart-order-summary",["cart-order-summary--loading",A],[`cart-order-summary__${S}`,S],g]),children:[A&&a(nr,{className:"cart-order-summary__spinner"}),l("div",{className:"cart-order-summary__heading",children:[x&&a(h,{node:x,className:"cart-order-summary__heading-text"}),a(ur,{variant:"primary",className:"cart-order-summary__divider-primary"})]}),l("div",{className:"cart-order-summary__content",children:[P,N,w,I,k,E,L]})]})},pr=({children:g,initialData:f=null,routeCheckout:S,slots:x,...A})=>{var v,u,P,N,w,I,k,E,L,m,O,W,G,z,F;const[r,d]=Z(f),{handleEstimateTotals:b,estimatedTotals:e,setEstimatedTotals:C,loading:p}=sr(),t=(v=er.config)==null?void 0:v.shoppingCartDisplaySetting;J(()=>{const c=K.on("cart/data",i=>{var y;d(i);const D=(y=i==null?void 0:i.addresses)==null?void 0:y.shipping,n=i==null?void 0:i.isVirtual;(D||n)&&C(null)},{eager:!0});return()=>{c==null||c.off()}},[]),J(()=>{const c=K.on("shipping/estimate",i=>{var y,T,U,V,X;const D={shippingCountry:(y=i==null?void 0:i.address)==null?void 0:y.countryCode,shippingState:(T=i==null?void 0:i.address)==null?void 0:T.region,shippingZip:(U=i==null?void 0:i.address)==null?void 0:U.postCode},n={carrier_code:((V=i==null?void 0:i.shippingMethod)==null?void 0:V.carrierCode)||"",method_code:((X=i==null?void 0:i.shippingMethod)==null?void 0:X.methodCode)||""};b(D,n)});return()=>{c==null||c.off()}},[b]);const _=Y({checkout:"Cart.PriceSummary.checkout",orderSummary:"Cart.PriceSummary.orderSummary",taxToBeDetermined:"Cart.PriceSummary.taxToBeDetermined"}),B=!(r!=null&&r.isVirtual)&&(x!=null&&x.EstimateShipping)?a(rr,{name:"EstimateShipping",slot:x.EstimateShipping},"estimateShippingId"):void 0;return!Object.keys(r??{}).length||(r==null?void 0:r.totalQuantity)===0?null:a(dr,{...A,"data-testid":"cart-order-summary",heading:a("div",{children:_.orderSummary}),shipping:B,loading:p,subTotal:{taxIncluded:(t==null?void 0:t.subtotal)==="INCLUDING_TAX"&&!(t!=null&&t.zeroTax),taxExcluded:(t==null?void 0:t.subtotal)==="INCLUDING_EXCLUDING_TAX",zeroTaxSubtotal:t==null?void 0:t.zeroTax,priceExcludingTax:(u=e==null?void 0:e.estimatedSubTotal)!=null&&u.excludingTax?a(o,{"data-testid":"subtotal",...(P=e==null?void 0:e.estimatedSubTotal)==null?void 0:P.excludingTax}):a(o,{"data-testid":"subtotal",amount:(N=r==null?void 0:r.subtotal.excludingTax)==null?void 0:N.value,currency:(w=r==null?void 0:r.subtotal.excludingTax)==null?void 0:w.currency}),price:!(t!=null&&t.zeroTax)&&(t==null?void 0:t.subtotal)==="INCLUDING_TAX"||!(t!=null&&t.zeroTax)&&(t==null?void 0:t.subtotal)==="INCLUDING_EXCLUDING_TAX"?(I=e==null?void 0:e.estimatedSubTotal)!=null&&I.includingTax?a(o,{"data-testid":"subtotal",...(k=e==null?void 0:e.estimatedSubTotal)==null?void 0:k.includingTax}):a(o,{"data-testid":"subtotal",amount:(E=r==null?void 0:r.subtotal.includingTax)==null?void 0:E.value,currency:(L=r==null?void 0:r.subtotal.includingTax)==null?void 0:L.currency}):a(o,{"data-testid":"subtotal",amount:(m=r==null?void 0:r.subtotal.excludingTax)==null?void 0:m.value,currency:(O=r==null?void 0:r.subtotal.excludingTax)==null?void 0:O.currency})},discounts:r==null?void 0:r.appliedDiscounts.map(c=>({label:c.label,price:a(o,{"data-testid":"summary-discount-total",amount:-c.amount.value,currency:c.amount.currency,sale:!0})})),taxTotal:r!=null&&r.isVirtual?{price:a("span",{"data-testid":"tax-total",children:_.taxToBeDetermined})}:{price:e!=null&&e.estimatedTaxTotal?a(o,{"data-testid":"tax-total",...e==null?void 0:e.estimatedTaxTotal}):r!=null&&r.totalTax?a(o,{"data-testid":"tax-total",amount:(W=r==null?void 0:r.totalTax)==null?void 0:W.value,currency:(G=r==null?void 0:r.totalTax)==null?void 0:G.currency}):a("span",{"data-testid":"tax-total",children:_.taxToBeDetermined}),estimated:!!(e!=null&&e.estimatedTaxTotal)},taxesApplied:r!=null&&r.isVirtual?void 0:t!=null&&t.fullSummary&&(e!=null&&e.estimatedAppliedTaxes)?(F=(z=e==null?void 0:e.estimatedAppliedTaxes)==null?void 0:z.taxes)==null?void 0:F.map(c=>({label:c.label,price:a(o,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):t!=null&&t.fullSummary?r==null?void 0:r.appliedTaxes.map(c=>({label:c.label,price:a(o,{"data-testid":"applied-taxes",amount:c.amount.value,currency:c.amount.currency})})):void 0,total:{price:e!=null&&e.estimatedGrandTotalPrice?a(o,{...e==null?void 0:e.estimatedGrandTotalPrice.includingTax}):a(o,{amount:r==null?void 0:r.total.includingTax.value,currency:r==null?void 0:r.total.includingTax.currency}),estimated:!!(e!=null&&e.estimatedGrandTotalPrice),priceWithoutTax:t!=null&&t.grandTotal?e!=null&&e.estimatedAppliedTaxes?a(o,{...e==null?void 0:e.estimatedGrandTotalPrice.excludingTax}):a(o,{amount:r==null?void 0:r.total.excludingTax.value,currency:r==null?void 0:r.total.excludingTax.currency}):void 0},primaryAction:S&&a(mr,{"data-testid":"checkout-button",variant:"primary",disabled:r==null?void 0:r.hasOutOfStockItems,"aria-disabled":r==null?void 0:r.hasOutOfStockItems,href:r!=null&&r.hasOutOfStockItems?void 0:S({cartId:r.id}),children:_.checkout})})};pr.getInitialData=async function(){return tr()};export{pr as OrderSummary,pr as default};
